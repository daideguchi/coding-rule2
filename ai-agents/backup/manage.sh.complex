#!/bin/bash
# ğŸ¤– AIçµ„ç¹”ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v2.0
# ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã€ãƒœã‚¹ã€ãƒ¯ãƒ¼ã‚«ãƒ¼ã®4ç”»é¢AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ 

set -e

# è‰²ä»˜ããƒ­ã‚°é–¢æ•°
log_info() {
    echo -e "\033[1;32m[INFO]\033[0m $1"
}

log_success() {
    echo -e "\033[1;34m[SUCCESS]\033[0m $1"
}

log_error() {
    echo -e "\033[1;31m[ERROR]\033[0m $1"
}

log_warn() {
    echo -e "\033[1;33m[WARN]\033[0m $1"
}

# åŸºæœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
AGENTS_DIR="ai-agents"
LOGS_DIR="$AGENTS_DIR/logs"
SESSIONS_DIR="$AGENTS_DIR/sessions"
INSTRUCTIONS_DIR="$AGENTS_DIR/instructions"
TMP_DIR="$AGENTS_DIR/tmp"

# å¿…è¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
init_directories() {
    mkdir -p "$LOGS_DIR" "$SESSIONS_DIR" "$INSTRUCTIONS_DIR"
    log_info "ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ"
}

# ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
create_session() {
    local role=$1
    local session_file="$SESSIONS_DIR/${role}_session.json"
    local timestamp=$(date -Iseconds)
    
    cat > "$session_file" << EOF
{
  "role": "$role",
  "session_id": "$(uuidgen 2>/dev/null || echo "session_$(date +%s)")",
  "start_time": "$timestamp",
  "status": "active",
  "messages": [],
  "context": {
    "current_task": null,
    "priority": "normal",
    "dependencies": []
  }
}
EOF
    
    log_success "ğŸ“ ${role} ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸ: $session_file"
}

# AIå½¹å‰²ã®å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå®Ÿéš›ã®Claude Codeä½¿ç”¨ï¼‰
start_ai_chat() {
    local role=$1
    local instruction_file="$INSTRUCTIONS_DIR/${role}.md"
    local session_file="$SESSIONS_DIR/${role}_session.json"
    local log_file="$LOGS_DIR/${role}.log"
    
    if [ ! -f "$instruction_file" ]; then
        log_error "âŒ æŒ‡ç¤ºæ›¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $instruction_file"
        return 1
    fi
    
    clear
    local role_upper=$(echo "$role" | tr '[:lower:]' '[:upper:]')
    echo "ğŸ¤– AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ  - ${role_upper} å¯¾è©±ãƒ¢ãƒ¼ãƒ‰"
    echo "=================================================="
    echo ""
    cat "$instruction_file"
    echo ""
    echo "=================================================="
    echo "ğŸ’¬ Claude Codeèµ·å‹•ä¸­...ï¼ˆè‡ªå‹•èªè¨¼ãƒ»æ¨©é™ã‚¹ã‚­ãƒƒãƒ—ï¼‰"
    echo ""
    
    # ãƒ­ã‚°é–‹å§‹
    echo "$(date): ${role} Claude Code ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹" >> "$log_file"
    
    # Claude Codeã‚’é«˜åº¦ãªè‡ªå‹•åŒ–ã§èµ·å‹•ï¼ˆstdin ã‚¨ãƒ©ãƒ¼å¯¾å¿œï¼‰
    if [ -f "./ai-agents/claude-stdin-fix.sh" ]; then
        # stdin ã‚¨ãƒ©ãƒ¼ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨
        ./ai-agents/claude-stdin-fix.sh auto "$(tmux display-message -p '#S')" "$(tmux display-message -p '#P')"
    elif [ -f "./ai-agents/claude-auto-bypass.sh" ]; then
        # å¾“æ¥ã®è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨
        ./ai-agents/claude-auto-bypass.sh advanced "$(tmux display-message -p '#S')" "$(tmux display-message -p '#P')"
    else
        # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        printf "2\n" | claude --dangerously-skip-permissions < /dev/null
    fi
}

# AIå¿œç­”ç”Ÿæˆï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆç‰ˆï¼‰
generate_ai_response() {
    local role=$1
    local input=$2
    
    case "$role" in
        "president")
            echo "ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã¨ã—ã¦æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ã€Œ$inputã€ã«ã¤ã„ã¦æˆ¦ç•¥çš„ã«æ¤œè¨ã—ã€é©åˆ‡ãªæŒ‡ç¤ºã‚’ãƒœã‚¹ã«ä¼é”ã—ã¾ã™ã€‚"
            ;;
        "boss")
            echo "ãƒœã‚¹ã¨ã—ã¦äº†è§£ã—ã¾ã—ãŸã€‚ã€Œ$inputã€ã®ä½œæ¥­ã‚’ãƒ¯ãƒ¼ã‚«ãƒ¼ã«åˆ†æ‹…ã—ã€é€²æ—ã‚’ç®¡ç†ã—ã¾ã™ã€‚"
            ;;
        "worker")
            echo "ãƒ¯ãƒ¼ã‚«ãƒ¼ã¨ã—ã¦æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ã€Œ$inputã€ã®ä½œæ¥­ã‚’å®Ÿè¡Œã—ã€å®Œäº†æ¬¡ç¬¬ãƒœã‚¹ã«å ±å‘Šã—ã¾ã™ã€‚"
            ;;
        *)
            echo "å½¹å‰²ãŒä¸æ˜ã§ã™ã€‚é©åˆ‡ãªæŒ‡ç¤ºã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"
            ;;
    esac
}

# ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
show_help() {
    echo "ğŸ¤– AIçµ„ç¹”ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v2.0"
    echo "=========================="
    echo ""
    echo "ä½¿ç”¨æ–¹æ³•:"
    echo "  ./ai-agents/manage.sh [ã‚³ãƒãƒ³ãƒ‰]"
    echo ""
    echo "ğŸš€ æ¨å¥¨ã‚³ãƒãƒ³ãƒ‰:"
    echo "  quick-start         4ç”»é¢AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ï¼ˆå…¨è‡ªå‹•ï¼‰"
    echo "  attach-multiagent   4ãƒ¯ãƒ¼ã‚«ãƒ¼è‡ªå‹•èµ·å‹•ï¼‹ã‚¢ã‚¿ãƒƒãƒï¼ˆå‚ç…§ãƒªãƒã‚¸ãƒˆãƒªæº–æ‹ ï¼‰"
    echo "  attach-president    PRESIDENTè‡ªå‹•èµ·å‹•ï¼‹ã‚¢ã‚¿ãƒƒãƒ"
    echo ""
    echo "åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰:"
    echo "  start               tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ"
    echo "  clean               ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤"
    echo "  claude-setup        Claude Codeä¸€æ‹¬èµ·å‹•"
    echo "  status              ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ç¢ºèª"
    echo ""
    echo "ğŸ”¥ å‚ç…§ãƒªãƒã‚¸ãƒˆãƒªæº–æ‹ ã®ä½¿ç”¨æ³•:"
    echo "  1. ./ai-agents/manage.sh quick-start        # ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ"
    echo "  2. ./ai-agents/manage.sh attach-multiagent  # 4ãƒ¯ãƒ¼ã‚«ãƒ¼è‡ªå‹•èµ·å‹•"
    echo "  3. ./ai-agents/manage.sh attach-president   # PRESIDENTè‡ªå‹•èµ·å‹•"
    echo "  ã¾ãŸã¯:"
    echo "  tmux attach-session -t multiagent           # æ‰‹å‹•ã‚¢ã‚¿ãƒƒãƒ"
    echo "  tmux attach-session -t president            # æ‰‹å‹•ã‚¢ã‚¿ãƒƒãƒ"
    echo ""
}

# çŠ¶æ³è¡¨ç¤º
show_status() {
    echo "ğŸ¤– AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³"
    echo "======================"
    echo ""
    
    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª
    echo "ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªçŠ¶æ³:"
    for dir in "$LOGS_DIR" "$SESSIONS_DIR" "$INSTRUCTIONS_DIR"; do
        if [ -d "$dir" ]; then
            echo "  âœ… $dir"
        else
            echo "  âŒ $dir (æœªä½œæˆ)"
        fi
    done
    echo ""
    
    # æŒ‡ç¤ºæ›¸ç¢ºèª
    echo "ğŸ“‹ æŒ‡ç¤ºæ›¸çŠ¶æ³:"
    for role in president boss worker; do
        local file="$INSTRUCTIONS_DIR/${role}.md"
        if [ -f "$file" ]; then
            echo "  âœ… $role ($file)"
        else
            echo "  âŒ $role ($file æœªä½œæˆ)"
        fi
    done
    echo ""
    
    # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
    echo "ğŸ’¬ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³:"
    if [ -d "$SESSIONS_DIR" ] && [ "$(ls -A $SESSIONS_DIR 2>/dev/null)" ]; then
        ls -la "$SESSIONS_DIR"/*.json 2>/dev/null | sed 's/^/  /' || echo "  ãªã—"
    else
        echo "  ãªã—"
    fi
    echo ""
    
    # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
    echo "ğŸ“Š ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«:"
    if [ -d "$LOGS_DIR" ] && [ "$(ls -A $LOGS_DIR 2>/dev/null)" ]; then
        ls -la "$LOGS_DIR"/*.log 2>/dev/null | sed 's/^/  /' || echo "  ãªã—"
    else
        echo "  ãªã—"
    fi
}

# 4ç”»é¢èµ·å‹•ã‚·ã‚¹ãƒ†ãƒ ï¼ˆCursorå†…ã‚¿ãƒ¼ãƒŸãƒŠãƒ« + tmuxå¯¾å¿œï¼‰
launch_four_screens() {
    log_info "ğŸš€ 4ç”»é¢AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•ä¸­..."
    
    # tmuxãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
    if command -v tmux &> /dev/null; then
        launch_tmux_sessions
    else
        launch_cursor_terminals
    fi
}

# tmuxç’°å¢ƒã§ã®èµ·å‹•ï¼ˆæ¨å¥¨ï¼‰
launch_tmux_sessions() {
    log_info "ğŸ“Š tmuxç’°å¢ƒã§AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•ä¸­..."
    
    # æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å‰Šé™¤
    tmux kill-session -t president 2>/dev/null || true
    tmux kill-session -t multiagent 2>/dev/null || true
    
    # PRESIDENTã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼ˆæ°¸ç¶šåŒ–ï¼‰
    tmux new-session -d -s president -c "$(pwd)"
    tmux send-keys -t president "echo 'ğŸ¯ PRESIDENT ã‚»ãƒƒã‚·ãƒ§ãƒ³ - å¯¾è©±é–‹å§‹æº–å‚™å®Œäº†'" C-m
    tmux send-keys -t president "echo 'ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰é–‹å§‹: ./ai-agents/manage.sh president'" C-m
    
    # multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼ˆ4ãƒšã‚¤ãƒ³ï¼‰
    tmux new-session -d -s multiagent -c "$(pwd)"
    tmux send-keys -t multiagent "echo 'ğŸ‘” BOSS1 ãƒšã‚¤ãƒ³ - å¯¾è©±é–‹å§‹æº–å‚™å®Œäº†'" C-m
    tmux send-keys -t multiagent "echo 'ãƒœã‚¹ãƒ¢ãƒ¼ãƒ‰é–‹å§‹: ./ai-agents/manage.sh boss'" C-m
    
    # è¿½åŠ ãƒšã‚¤ãƒ³ä½œæˆ
    tmux split-window -t multiagent -h -c "$(pwd)"
    tmux send-keys -t multiagent:0.1 "echo 'ğŸ‘· WORKER1 ãƒšã‚¤ãƒ³ - å¯¾è©±é–‹å§‹æº–å‚™å®Œäº†'" C-m
    tmux send-keys -t multiagent:0.1 "echo 'ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ¢ãƒ¼ãƒ‰é–‹å§‹: ./ai-agents/manage.sh worker'" C-m
    
    tmux split-window -t multiagent:0.1 -v -c "$(pwd)"
    tmux send-keys -t multiagent:0.2 "echo 'ğŸ‘· WORKER2 ãƒšã‚¤ãƒ³ - å¯¾è©±é–‹å§‹æº–å‚™å®Œäº†'" C-m
    tmux send-keys -t multiagent:0.2 "echo 'ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ¢ãƒ¼ãƒ‰é–‹å§‹: ./ai-agents/manage.sh worker'" C-m
    
    tmux select-pane -t multiagent:0.0
    tmux split-window -t multiagent:0.0 -v -c "$(pwd)"
    tmux send-keys -t multiagent:0.1 "echo 'ğŸ‘· WORKER3 ãƒšã‚¤ãƒ³ - å¯¾è©±é–‹å§‹æº–å‚™å®Œäº†'" C-m
    tmux send-keys -t multiagent:0.1 "echo 'ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ¢ãƒ¼ãƒ‰é–‹å§‹: ./ai-agents/manage.sh worker'" C-m
    
    # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´
    tmux select-layout -t multiagent tiled
    
    log_success "âœ… AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ã®tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸ"
    echo ""
    echo "ğŸ“‹ ã€æ—¥æœ¬èªå¯¾å¿œã€‘AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ç¢ºèª:"
    echo "  tmux attach-session -t president    # ğŸ‘‘ PRESIDENTç”»é¢ï¼ˆçµ±æ‹¬AIï¼‰"
    echo "  tmux attach-session -t multiagent   # ğŸ‘¥ 4ç”»é¢è¡¨ç¤ºï¼ˆBOSS+WORKERï¼‰"
    echo ""
    echo "ğŸš€ ã€ç°¡å˜3ã‚¹ãƒ†ãƒƒãƒ—ã€‘AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•æ–¹æ³•:"
    echo "  1ï¸âƒ£ ./ai-agents/manage.sh auto           # ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰èµ·å‹•"
    echo "  2ï¸âƒ£ PRESIDENTç”»é¢ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŒ‡ç¤º      # AIã«æ—¥æœ¬èªã§æŒ‡ç¤º"
    echo "  3ï¸âƒ£ tmux attach-session -t multiagent   # 4ç”»é¢ã§AIæ´»å‹•ç›£è¦–"
    echo ""
    echo "ğŸ¯ ã€Claude CodeçŠ¶æ…‹ã€‘å…¨ã¦ã®AIãŒæ—¥æœ¬èªå¯¾å¿œã§èµ·å‹•æº–å‚™å®Œäº†"
}

# Cursorå†…ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã®èµ·å‹•
launch_cursor_terminals() {
    log_info "ğŸ’» Cursorå†…ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•ä¸­..."
    
    # macOSã®å ´åˆ
    if [[ "$OSTYPE" == "darwin"* ]]; then
        # Cursorã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‘ã‘ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«èµ·å‹•
        osascript << EOF
tell application "Cursor"
    activate
end tell

tell application "System Events"
    tell process "Cursor"
        -- æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãï¼ˆCmd+Shift+\`ï¼‰
        keystroke "\`" using {command down, shift down}
        delay 0.5
        
        -- PRESIDENTèµ·å‹•
        keystroke "echo 'ğŸ¯ PRESIDENTç”»é¢' && ./ai-agents/manage.sh president"
        key code 36
        
        delay 1
        
        -- æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆBOSSï¼‰
        keystroke "\`" using {command down, shift down}
        delay 0.5
        keystroke "echo 'ğŸ‘” BOSSç”»é¢' && ./ai-agents/manage.sh boss"
        key code 36
        
        delay 1
        
        -- æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆWORKER1ï¼‰
        keystroke "\`" using {command down, shift down}
        delay 0.5
        keystroke "echo 'ğŸ‘· WORKER1ç”»é¢' && ./ai-agents/manage.sh worker"
        key code 36
        
        delay 1
        
        -- æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆWORKER2ï¼‰
        keystroke "\`" using {command down, shift down}
        delay 0.5
        keystroke "echo 'ğŸ‘· WORKER2ç”»é¢' && ./ai-agents/manage.sh worker"
        key code 36
    end tell
end tell
EOF
        log_success "âœ… Cursorå†…ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’èµ·å‹•ã—ã¾ã—ãŸ"
        
    # Linuxã®å ´åˆ
    elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
        # gnome-terminalã¾ãŸã¯xtermã‚’ä½¿ç”¨
        if command -v gnome-terminal &> /dev/null; then
            gnome-terminal --tab --title="PRESIDENT" -- bash -c "cd $(pwd) && echo 'ğŸ¯ PRESIDENTç”»é¢' && ./ai-agents/manage.sh president; exec bash" &
            gnome-terminal --tab --title="BOSS" -- bash -c "cd $(pwd) && echo 'ğŸ‘” BOSSç”»é¢' && ./ai-agents/manage.sh boss; exec bash" &
            gnome-terminal --tab --title="WORKER1" -- bash -c "cd $(pwd) && echo 'ğŸ‘· WORKER1ç”»é¢' && ./ai-agents/manage.sh worker; exec bash" &
            gnome-terminal --tab --title="WORKER2" -- bash -c "cd $(pwd) && echo 'ğŸ‘· WORKER2ç”»é¢' && ./ai-agents/manage.sh worker; exec bash" &
            log_success "âœ… 4ç”»é¢ã‚’èµ·å‹•ã—ã¾ã—ãŸï¼ˆLinux gnome-terminalï¼‰"
        elif command -v xterm &> /dev/null; then
            xterm -T "PRESIDENT" -e "cd $(pwd) && echo 'ğŸ¯ PRESIDENTç”»é¢' && ./ai-agents/manage.sh president" &
            xterm -T "BOSS" -e "cd $(pwd) && echo 'ğŸ‘” BOSSç”»é¢' && ./ai-agents/manage.sh boss" &
            xterm -T "WORKER1" -e "cd $(pwd) && echo 'ğŸ‘· WORKER1ç”»é¢' && ./ai-agents/manage.sh worker" &
            xterm -T "WORKER2" -e "cd $(pwd) && echo 'ğŸ‘· WORKER2ç”»é¢' && ./ai-agents/manage.sh worker" &
            log_success "âœ… 4ç”»é¢ã‚’èµ·å‹•ã—ã¾ã—ãŸï¼ˆLinux xtermï¼‰"
        else
            log_error "âŒ å¯¾å¿œã™ã‚‹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            return 1
        fi
    else
        log_warn "âš ï¸  ã“ã®OSã§ã¯è‡ªå‹•4ç”»é¢èµ·å‹•ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“"
        echo "æ‰‹å‹•ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’4ã¤ã®åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š"
        echo "  ./ai-agents/manage.sh president"
        echo "  ./ai-agents/manage.sh boss"
        echo "  ./ai-agents/manage.sh worker"
        echo "  ./ai-agents/manage.sh worker"
    fi
}

# ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ç¢ºèª
system_status() {
    echo "ğŸ¤– AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³"
    echo "======================"
    echo ""
    
    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª
    echo "ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªçŠ¶æ³:"
    for dir in "$LOGS_DIR" "$SESSIONS_DIR" "$INSTRUCTIONS_DIR"; do
        if [ -d "$dir" ]; then
            echo "  âœ… $dir"
        else
            echo "  âŒ $dir (æœªä½œæˆ)"
        fi
    done
    echo ""
    
    # æŒ‡ç¤ºæ›¸ç¢ºèª
    echo "ğŸ“‹ æŒ‡ç¤ºæ›¸çŠ¶æ³:"
    for role in president boss worker; do
        local file="$INSTRUCTIONS_DIR/${role}.md"
        if [ -f "$file" ]; then
            echo "  âœ… $role ($file)"
        else
            echo "  âŒ $role ($file æœªä½œæˆ)"
        fi
    done
    echo ""
    
    # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
    echo "ğŸ’¬ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³:"
    if [ -d "$SESSIONS_DIR" ] && [ "$(ls -A $SESSIONS_DIR 2>/dev/null)" ]; then
        ls -la "$SESSIONS_DIR"/*.json 2>/dev/null | sed 's/^/  /' || echo "  ãªã—"
    else
        echo "  ãªã—"
    fi
    echo ""
    
    # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
    echo "ğŸ“Š ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«:"
    if [ -d "$LOGS_DIR" ] && [ "$(ls -A $LOGS_DIR 2>/dev/null)" ]; then
        ls -la "$LOGS_DIR"/*.log 2>/dev/null | sed 's/^/  /' || echo "  ãªã—"
    else
        echo "  ãªã—"
    fi
}

# Claude Codeä¸€æ‹¬èµ·å‹•
setup_claude_code() {
    log_info "ğŸš€ Claude Codeä¸€æ‹¬èµ·å‹•ã‚·ã‚¹ãƒ†ãƒ ..."
    
    # agent-send.shã‚’ä½¿ç”¨
    if [ -f "./ai-agents/agent-send.sh" ]; then
        chmod +x "./ai-agents/agent-send.sh"
        "./ai-agents/agent-send.sh" --claude-setup
    else
        log_error "âŒ agent-send.shãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        return 1
    fi
}

# ãƒ‡ãƒ¢å®Ÿè¡Œ
run_demo() {
    log_info "ğŸ¬ Hello World ãƒ‡ãƒ¢å®Ÿè¡Œ..."
    
    # agent-send.shã‚’ä½¿ç”¨
    if [ -f "./ai-agents/agent-send.sh" ]; then
        chmod +x "./ai-agents/agent-send.sh"
        "./ai-agents/agent-send.sh" --demo
    else
        log_error "âŒ agent-send.shãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        return 1
    fi
}

# ç°¡å˜4ç”»é¢èµ·å‹•ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚å¯¾å¿œï¼‰
quick_start() {
    log_info "ğŸš€ ç°¡å˜4ç”»é¢AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ä¸­..."
    
    # æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å‰Šé™¤
    tmux kill-session -t president 2>/dev/null || true
    tmux kill-session -t multiagent 2>/dev/null || true
    
    # PRESIDENTã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆClaude Codeè»½é‡èµ·å‹•ï¼‰
    tmux new-session -d -s president -c "$(pwd)"
    tmux send-keys -t president "clear" C-m
    tmux send-keys -t president "echo 'ğŸ¯ PRESIDENT ã‚»ãƒƒã‚·ãƒ§ãƒ³ - è»½é‡èµ·å‹•ä¸­...'" C-m
    tmux send-keys -t president "claude --dangerously-skip-permissions" C-m
    
    # multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆ4ãƒšã‚¤ãƒ³è»½é‡èµ·å‹•ï¼‰
    tmux new-session -d -s multiagent -c "$(pwd)"
    
    # BOSS1ãƒšã‚¤ãƒ³
    tmux send-keys -t multiagent "clear" C-m
    tmux send-keys -t multiagent "echo 'ğŸ‘” BOSS1 ãƒšã‚¤ãƒ³ - è»½é‡èµ·å‹•ä¸­...'" C-m
    tmux send-keys -t multiagent "claude --dangerously-skip-permissions" C-m
    
    # WORKER1ãƒšã‚¤ãƒ³
    tmux split-window -t multiagent -h -c "$(pwd)"
    tmux send-keys -t multiagent:0.1 "clear" C-m
    tmux send-keys -t multiagent:0.1 "echo 'ğŸ‘· WORKER1 ãƒšã‚¤ãƒ³ - è»½é‡èµ·å‹•ä¸­...'" C-m
    tmux send-keys -t multiagent:0.1 "claude --dangerously-skip-permissions" C-m
    
    # WORKER2ãƒšã‚¤ãƒ³
    tmux split-window -t multiagent:0.1 -v -c "$(pwd)"
    tmux send-keys -t multiagent:0.2 "clear" C-m
    tmux send-keys -t multiagent:0.2 "echo 'ğŸ‘· WORKER2 ãƒšã‚¤ãƒ³ - è»½é‡èµ·å‹•ä¸­...'" C-m
    tmux send-keys -t multiagent:0.2 "claude --dangerously-skip-permissions" C-m
    
    # WORKER3ãƒšã‚¤ãƒ³
    tmux select-pane -t multiagent:0.0
    tmux split-window -t multiagent:0.0 -v -c "$(pwd)"
    tmux send-keys -t multiagent:0.1 "clear" C-m
    tmux send-keys -t multiagent:0.1 "echo 'ğŸ‘· WORKER3 ãƒšã‚¤ãƒ³ - è»½é‡èµ·å‹•ä¸­...'" C-m
    tmux send-keys -t multiagent:0.1 "claude --dangerously-skip-permissions" C-m
    
    # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæœ€é©åŒ–
    tmux select-layout -t multiagent tiled
    
    # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è»½é‡ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ï¼ˆ15ç§’é–“éš”ï¼‰
    (
        # PRESIDENTé«˜é€Ÿèµ·å‹•æ¤œçŸ¥ï¼ˆ2ç§’é–“éš”ã§ãƒã‚§ãƒƒã‚¯ï¼‰
        while ! tmux capture-pane -t president -p 2>/dev/null | grep -q "Welcome to Claude Code\|cwd:"; do
            sleep 2
        done
        
        # PRESIDENTè»½é‡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆã€Œ>ã€ä»˜ãã§è‡ªå‹•å®Ÿè¡Œå¯¾å¿œ + ãƒ¯ãƒ¼ã‚«ãƒ¼æŒ‡ç¤ºãƒ«ãƒ¼ãƒ«è¿½åŠ ï¼‰
        tmux send-keys -t president ">ã‚ãªãŸã¯ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã§ã™ã€‚./ai-agents/instructions/president.mdã®æŒ‡ç¤ºæ›¸ã‚’å‚ç…§ã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ã€é‡è¦ã€‘ãƒ¯ãƒ¼ã‚«ãƒ¼ã«æŒ‡ç¤ºã‚’é€ã‚‹æ™‚ã¯å¿…ãšæ–‡é ­ã«ã€Œ>ã€ã‚’ä»˜ã‘ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š>ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼‰ã€‚ã•ã‚‰ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å››äººã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’èµ·å‹•ã—ã¦ãã ã•ã„ã€‚" C-m
        sleep 3
        tmux send-keys -t president ">for i in {0..3}; do tmux send-keys -t multiagent:0.\$i 'claude --dangerously-skip-permissions ' C-m; done" C-m
        
        # å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã®é«˜é€Ÿèµ·å‹•æ¤œçŸ¥ï¼ˆ2ç§’é–“éš”ã§ä¸¦åˆ—ãƒã‚§ãƒƒã‚¯ï¼‰
        for i in {0..3}; do
            (
                while ! tmux capture-pane -t multiagent:0.$i -p 2>/dev/null | grep -q "Welcome to Claude Code\|cwd:"; do
                    sleep 2
                done
                
                # å„ãƒ¯ãƒ¼ã‚«ãƒ¼è»½é‡å½¹å‰²è¨­å®šï¼ˆã€Œ>ã€ä»˜ãã§è‡ªå‹•å®Ÿè¡Œå¯¾å¿œï¼‰
                case $i in
                    0) tmux send-keys -t multiagent:0.0 ">ã‚ãªãŸã¯BOSS1ã§ã™ã€‚./ai-agents/instructions/boss.mdã®æŒ‡ç¤ºæ›¸ã‚’å‚ç…§ã—ã¦ã€ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦è¡Œå‹•ã—ã¦ãã ã•ã„ã€‚æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" C-m ;;
                    1) tmux send-keys -t multiagent:0.1 ">ã‚ãªãŸã¯WORKER1ã§ã™ã€‚./ai-agents/instructions/worker.mdã®æŒ‡ç¤ºæ›¸ã‚’å‚ç…§ã—ã¦ã€å®Ÿè¡Œæ‹…å½“ã¨ã—ã¦è¡Œå‹•ã—ã¦ãã ã•ã„ã€‚æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" C-m ;;
                    2) tmux send-keys -t multiagent:0.2 ">ã‚ãªãŸã¯WORKER2ã§ã™ã€‚./ai-agents/instructions/worker.mdã®æŒ‡ç¤ºæ›¸ã‚’å‚ç…§ã—ã¦ã€å®Ÿè¡Œæ‹…å½“ã¨ã—ã¦è¡Œå‹•ã—ã¦ãã ã•ã„ã€‚æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" C-m ;;
                    3) tmux send-keys -t multiagent:0.3 ">ã‚ãªãŸã¯WORKER3ã§ã™ã€‚./ai-agents/instructions/worker.mdã®æŒ‡ç¤ºæ›¸ã‚’å‚ç…§ã—ã¦ã€å®Ÿè¡Œæ‹…å½“ã¨ã—ã¦è¡Œå‹•ã—ã¦ãã ã•ã„ã€‚æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" C-m ;;
                esac
            ) &
        done
        
        # å®Œäº†å¾…ã¡
        wait
        echo "âš¡ å…¨AIé«˜é€Ÿè‡ªå‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å®Œäº† ($(date))" > /tmp/ai-agents-auto-setup.log
    ) &
    
    log_success "âœ… 4ç”»é¢AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†"
    echo ""
    echo "ğŸ¯ æ¬¡ã®æ‰‹é †ã§ä½¿ç”¨é–‹å§‹:"
    echo ""
    echo "ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1ã€‘ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆç”»é¢:"
    echo "  tmux attach-session -t president"
    echo ""
    echo "ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2ã€‘ãƒ¯ãƒ¼ã‚«ãƒ¼4ç”»é¢:"
    echo "  tmux attach-session -t multiagent"
    echo ""
    echo "ğŸ’¡ ä½¿ç”¨æ–¹æ³•:"
    echo "  1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1ï¼ˆpresidentï¼‰ã§æŒ‡ç¤ºé–‹å§‹:"
    echo "     'ã‚ãªãŸã¯presidentã§ã™ã€‚æŒ‡ç¤ºæ›¸ã«å¾“ã£ã¦'"
    echo ""
    echo "  2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2ï¼ˆmultiagentï¼‰ã§å„AIã®ä½œæ¥­ç¢ºèª"
    echo ""
    echo "  3. å®Ÿéš›ã®Claude Code AIãŒéšå±¤çµ„ç¹”ã§å‹•ä½œ"
    echo ""
    echo "ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª:"
    echo "  tmux list-sessions  # ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ç¢ºèª"
}

# multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•èµ·å‹•ã‚¢ã‚¿ãƒƒãƒï¼ˆå‚ç…§ãƒªãƒã‚¸ãƒˆãƒªå¯¾å¿œï¼‰
attach_multiagent() {
    log_info "ğŸš€ multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•èµ·å‹•ã‚¢ã‚¿ãƒƒãƒä¸­..."
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
    if ! tmux has-session -t multiagent 2>/dev/null; then
        log_error "âŒ multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å…ˆã«èµ·å‹•ã—ã¦ãã ã•ã„:"
        echo "  ./ai-agents/manage.sh start"
        return 1
    fi
    
    # Cursorå†…ã§æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãï¼ˆmacOSå¯¾å¿œï¼‰
    log_info "ğŸ–¥ï¸ Cursorå†…ã§æ–°ã‚¿ãƒ¼ãƒŸãƒŠãƒ«èµ·å‹•ä¸­..."
    
    # æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¿ãƒ–ã‚’é–‹ã
    if command -v osascript &> /dev/null; then
        # macOSã®å ´åˆï¼šCmd+Shift+T ã§æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
        osascript -e 'tell application "System Events" to keystroke "t" using {command down, shift down}' &
        sleep 2
    fi
    
    # 4ã¤ã®ãƒšã‚¤ãƒ³ã§Claude Codeè‡ªå‹•èµ·å‹•ï¼ˆå‚ç…§ãƒªãƒã‚¸ãƒˆãƒªæº–æ‹ ï¼‰
    log_info "ğŸ¤– 4ãƒ¯ãƒ¼ã‚«ãƒ¼è‡ªå‹•èµ·å‹•ä¸­..."
    
    # ãƒšã‚¤ãƒ³0.0: boss1
    tmux send-keys -t multiagent:0.0 "echo 'ğŸ‘” BOSS1 - Claude Codeèµ·å‹•ä¸­...'" C-m
    tmux send-keys -t multiagent:0.0 "printf '2\\n' | claude --dangerously-skip-permissions < /dev/null" C-m
    
    # ãƒšã‚¤ãƒ³0.1: worker1  
    tmux send-keys -t multiagent:0.1 "echo 'ğŸ‘· WORKER1 - Claude Codeèµ·å‹•ä¸­...'" C-m
    tmux send-keys -t multiagent:0.1 "printf '2\\n' | claude --dangerously-skip-permissions < /dev/null" C-m
    
    # ãƒšã‚¤ãƒ³0.2: worker2
    tmux send-keys -t multiagent:0.2 "echo 'ğŸ‘· WORKER2 - Claude Codeèµ·å‹•ä¸­...'" C-m
    tmux send-keys -t multiagent:0.2 "printf '2\\n' | claude --dangerously-skip-permissions < /dev/null" C-m
    
    # ãƒšã‚¤ãƒ³0.3: worker3
    tmux send-keys -t multiagent:0.3 "echo 'ğŸ‘· WORKER3 - Claude Codeèµ·å‹•ä¸­...'" C-m
    tmux send-keys -t multiagent:0.3 "printf '2\\n' | claude --dangerously-skip-permissions < /dev/null" C-m
    
    sleep 1
    log_success "âœ… 4ãƒ¯ãƒ¼ã‚«ãƒ¼è‡ªå‹•èµ·å‹•å®Œäº†"
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¿ãƒƒãƒ
    tmux attach-session -t multiagent
}

# presidentã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•èµ·å‹•ã‚¢ã‚¿ãƒƒãƒ
attach_president() {
    log_info "ğŸ¯ presidentã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•èµ·å‹•ã‚¢ã‚¿ãƒƒãƒä¸­..."
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
    if ! tmux has-session -t president 2>/dev/null; then
        log_error "âŒ presidentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å…ˆã«èµ·å‹•ã—ã¦ãã ã•ã„:"
        echo "  ./ai-agents/manage.sh quick-start"
        return 1
    fi
    
    # Claude Codeè‡ªå‹•èµ·å‹•
    tmux send-keys -t president "echo 'ğŸ¯ PRESIDENT - Claude Codeèµ·å‹•ä¸­...'" C-m
    tmux send-keys -t president "claude --dangerously-skip-permissions" C-m
    
    # è‡ªå‹•èµ·å‹•å®Œäº†ã‚’å¾…ã¤
    sleep 3
    
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªå‹•é€ä¿¡ï¼ˆå‰ã®å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ã€ã€Œ>ã€ä»˜ãã§è‡ªå‹•å®Ÿè¡Œå¯¾å¿œ + ãƒ¯ãƒ¼ã‚«ãƒ¼æŒ‡ç¤ºãƒ«ãƒ¼ãƒ«è¿½åŠ ï¼‰
    tmux send-keys -t president C-c  # å‰ã®å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
    sleep 0.1
    tmux send-keys -t president ">ã‚ãªãŸã¯ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã§ã™ã€‚./ai-agents/instructions/president.mdã®æŒ‡ç¤ºæ›¸ã‚’å‚ç…§ã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ã€é‡è¦ã€‘ãƒ¯ãƒ¼ã‚«ãƒ¼ã«æŒ‡ç¤ºã‚’é€ã‚‹æ™‚ã¯å¿…ãšæ–‡é ­ã«ã€Œ>ã€ã‚’ä»˜ã‘ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š>ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼‰ã€‚ã•ã‚‰ã«ãƒ¯ãƒ¼ã‚«ãƒ¼ãŸã¡ã‚’ç«‹ã¡ä¸Šã’ã¦ãƒœã‚¹ã«æŒ‡ä»¤ã‚’ä¼é”ã—ã¦ä¸‹ã•ã„ã€‚" C-m
    sleep 1
    tmux send-keys -t president ">for i in {0..3}; do tmux send-keys -t multiagent:0.\$i 'claude --dangerously-skip-permissions ' C-m; done" C-m
    
    log_success "âœ… PRESIDENTè‡ªå‹•èµ·å‹•å®Œäº†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ¸ˆã¿ï¼‰"
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¿ãƒƒãƒ
    tmux attach-session -t president
}

# ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤é–¢æ•°
clean_sessions() {
    log_info "ğŸ§¹ AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤ä¸­..."
    
    # æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å‰Šé™¤
    tmux kill-session -t president 2>/dev/null || true
    tmux kill-session -t multiagent 2>/dev/null || true
    
    log_success "âœ… å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤å®Œäº†"
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
    echo ""
    echo "ğŸ“Š ç¾åœ¨ã®tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³:"
    tmux list-sessions 2>/dev/null || echo "  ã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—"
}

# claude-authé–¢æ•°ï¼ˆé€£æºã‚¿ã‚¤ãƒŸãƒ³ã‚°å®Œå…¨è¦‹ç›´ã—ç‰ˆï¼‰
claude_auth_function() {
    log_info "ğŸš€ Claude Auth - é€£æºã‚¿ã‚¤ãƒŸãƒ³ã‚°å®Œå…¨è¦‹ç›´ã—ç‰ˆèµ·å‹•ä¸­..."
    
    # æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤
    tmux kill-session -t president 2>/dev/null || true
    tmux kill-session -t multiagent 2>/dev/null || true
    
    # æ®µéš1: PRESIDENTã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
    log_info "ğŸ“‹ ã€æ®µéš1/6ã€‘PRESIDENTã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆä¸­..."
    tmux new-session -d -s president -c "$(pwd)"
    tmux send-keys -t president "clear" C-m
    tmux send-keys -t president "echo 'ğŸ¯ PRESIDENT ã‚»ãƒƒã‚·ãƒ§ãƒ³ - é€£æºã‚¿ã‚¤ãƒŸãƒ³ã‚°å®Œå…¨è¦‹ç›´ã—ç‰ˆ'" C-m
    log_success "âœ… PRESIDENTã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆå®Œäº†"
    
    # æ®µéš2: multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼ˆ4ç”»é¢ï¼‰
    log_info "ğŸ“‹ ã€æ®µéš2/6ã€‘multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆä¸­..."
    tmux new-session -d -s multiagent -c "$(pwd)"
    tmux split-window -h -t multiagent
    tmux split-window -v -t multiagent:0.0
    tmux split-window -v -t multiagent:0.1
    tmux select-layout -t multiagent tiled
    
    # å„ãƒšã‚¤ãƒ³ã®æº–å‚™
    for i in {0..3}; do
        tmux send-keys -t multiagent:0.$i "clear" C-m
        case $i in
            0) tmux send-keys -t multiagent:0.0 "echo 'ğŸ‘” BOSS - é€£æºå¾…æ©Ÿä¸­...'" C-m ;;
            1) tmux send-keys -t multiagent:0.1 "echo 'ğŸ‘· WORKER1 - é€£æºå¾…æ©Ÿä¸­...'" C-m ;;
            2) tmux send-keys -t multiagent:0.2 "echo 'ğŸ‘· WORKER2 - é€£æºå¾…æ©Ÿä¸­...'" C-m ;;
            3) tmux send-keys -t multiagent:0.3 "echo 'ğŸ‘· WORKER3 - é€£æºå¾…æ©Ÿä¸­...'" C-m ;;
        esac
    done
    log_success "âœ… multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆå®Œäº†"
    
    # æ®µéš3: PRESIDENT Claude Codeèµ·å‹•ãƒ»ç¢ºå®Ÿç¢ºèª
    log_info "ğŸ“‹ ã€æ®µéš3/6ã€‘PRESIDENT Claude Codeèµ·å‹•ãƒ»ç¢ºå®Ÿç¢ºèªä¸­..."
    tmux send-keys -t president "claude --dangerously-skip-permissions" C-m
    
    # èµ·å‹•å®Œäº†å¾…æ©Ÿï¼ˆé«˜é€Ÿç¢ºèªãƒ»æœ€å¤§60ç§’ï¼‰
    log_info "â³ PRESIDENT Claude Codeèµ·å‹•å®Œäº†å¾…æ©Ÿä¸­ï¼ˆé«˜é€Ÿç¢ºèªï¼‰..."
    for i in {1..30}; do
        screen_content=$(tmux capture-pane -t president -p 2>/dev/null || echo "")
        if echo "$screen_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
            log_success "âœ… PRESIDENT Claude Codeèµ·å‹•å®Œäº† (${i}ç§’)"
            break
        fi
        if [ $((i % 5)) -eq 0 ]; then
            log_info "â³ PRESIDENTèµ·å‹•ç¢ºèªä¸­: ${i}/30ç§’çµŒé"
        fi
        sleep 2
    done
    
    if [ $i -eq 30 ]; then
        log_error "âŒ PRESIDENTèµ·å‹•ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ60ç§’ï¼‰ - æ‰‹å‹•ã§ç¢ºèªã—ã¦ãã ã•ã„"
        tmux attach-session -t president
        return 1
    fi
    
    # æ®µéš4: PRESIDENTãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ»ç¢ºå®Ÿå±•é–‹ç¢ºèª
    log_info "ğŸ“‹ ã€æ®µéš4/6ã€‘PRESIDENTãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ»ç¢ºå®Ÿå±•é–‹ç¢ºèªä¸­..."
    sleep 2  # å®‰å®šåŒ–å¾…æ©Ÿ
    
    # æ®µéšçš„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆç¢ºå®Ÿå±•é–‹ã®ãŸã‚åˆ†å‰²ï¼‰
    log_info "ğŸ“¤ åŸºæœ¬æŒ‡ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ä¸­..."
    tmux send-keys -t president "ã‚ãªãŸã¯ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã§ã™ã€‚./ai-agents/instructions/president.mdã®æŒ‡ç¤ºæ›¸ã‚’å‚ç…§ã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚" C-m
    sleep 3  # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†å¾…æ©Ÿ
    
    log_info "ğŸ“¤ ãƒ¯ãƒ¼ã‚«ãƒ¼æŒ‡ç¤ºãƒ«ãƒ¼ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ä¸­..."
    tmux send-keys -t president "ã€é‡è¦ã€‘ãƒ¯ãƒ¼ã‚«ãƒ¼ã«æŒ‡ç¤ºã‚’é€ã‚‹æ™‚ã¯å¿…ãšæ–‡é ­ã«ã€Œ>ã€ã‚’ä»˜ã‘ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š>ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼‰" C-m
    sleep 3  # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†å¾…æ©Ÿ
    
    log_info "ğŸ“¤ ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•æŒ‡ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ä¸­..."
    tmux send-keys -t president "ã¾ãšæœ€åˆã«ã€å¿…ãšä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãƒ¯ãƒ¼ã‚«ãƒ¼ãŸã¡ã‚’èµ·å‹•ã—ã¦ãã ã•ã„ï¼š" C-m
    sleep 2
    tmux send-keys -t president "for i in {0..3}; do tmux send-keys -t multiagent:0.\$i 'claude --dangerously-skip-permissions' C-m; done" C-m
    
    # PRESIDENTã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†å®Œäº†ç¢ºèª
    log_info "ğŸ” PRESIDENTãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†å®Œäº†ç¢ºèªä¸­..."
    for j in {1..20}; do
        president_content=$(tmux capture-pane -t president -p 2>/dev/null | tail -3)
        if echo "$president_content" | grep -qE "(Please let me know|How can I help|ä½•ã‹ãŠæ‰‹ä¼ã„)" 2>/dev/null; then
            log_success "âœ… PRESIDENTãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†å®Œäº†ç¢ºèª (${j}/20ç§’)"
            break
        fi
        sleep 1
    done
    
    log_success "âœ… PRESIDENTãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ»å±•é–‹å®Œäº†"
    
    # æ®µéš5: ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•ãƒ»å—ä¿¡ç¢ºèª
    log_info "ğŸ“‹ ã€æ®µéš5/6ã€‘ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•ãƒ»å—ä¿¡ç¢ºèªä¸­..."
    sleep 3  # PRESIDENTã®å‡¦ç†å¾…æ©Ÿ
    
    # ãƒ¯ãƒ¼ã‚«ãƒ¼ç¢ºå®Ÿèµ·å‹•ï¼ˆç›´æ¥å®Ÿè¡Œï¼‰
    for i in {0..3}; do
        log_info "ğŸš€ WORKER${i} èµ·å‹•ãƒ»å—ä¿¡ç¢ºèªä¸­..."
        tmux send-keys -t multiagent:0.$i "claude --dangerously-skip-permissions" C-m
        
        # å€‹åˆ¥èµ·å‹•ç¢ºèªï¼ˆè»½é‡ç›£è¦–ï¼‰
        for k in {1..2}; do
            worker_content=$(tmux capture-pane -t multiagent:0.$i -p 2>/dev/null || echo "")
            if echo "$worker_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
                log_success "âœ… WORKER${i} èµ·å‹•å®Œäº† (${k}å›ç›®ãƒã‚§ãƒƒã‚¯)"
                
                # å½¹å‰²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ»å—ä¿¡ç¢ºèª
                case $i in
                    0) role_msg="ã‚ãªãŸã¯BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ã§ã™ã€‚./ai-agents/instructions/boss.md ã‚’å‚ç…§ã—ã¦æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" ;;
                    1) role_msg="ã‚ãªãŸã¯WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚./ai-agents/instructions/worker.md ã‚’å‚ç…§ã—ã¦æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" ;;
                    2) role_msg="ã‚ãªãŸã¯WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚./ai-agents/instructions/worker.md ã‚’å‚ç…§ã—ã¦æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" ;;
                    3) role_msg="ã‚ãªãŸã¯WORKER3ãƒ»UI/UXãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã§ã™ã€‚./ai-agents/instructions/worker.md ã‚’å‚ç…§ã—ã¦æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" ;;
                esac
                
                sleep 2  # å®‰å®šåŒ–å¾…æ©Ÿ
                tmux send-keys -t multiagent:0.$i "$role_msg" C-m
                
                # å½¹å‰²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ç¢ºèª
                sleep 3
                worker_response=$(tmux capture-pane -t multiagent:0.$i -p 2>/dev/null | tail -3)
                if echo "$worker_response" | grep -qE "(Please let me know|How can I help|æ‰¿çŸ¥|ç†è§£)" 2>/dev/null; then
                    log_success "âœ… WORKER${i} å½¹å‰²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ãƒ»å‡¦ç†å®Œäº†"
                else
                    log_warn "âš ï¸ WORKER${i} å½¹å‰²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡æœªç¢ºèª"
                fi
                break
            fi
            sleep 15
        done
        
        if [ $k -eq 2 ]; then
            log_error "âŒ WORKER${i} èµ·å‹•ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆè»½é‡ç›£è¦–2å›ï¼‰"
        fi
    done
    
    log_success "âœ… å…¨ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•ãƒ»å—ä¿¡ç¢ºèªå®Œäº†"
    
    # æ®µéš6: é€£æºç¢ºèªãƒ»UIè¨­å®š
    log_info "ğŸ“‹ ã€æ®µéš6/6ã€‘é€£æºç¢ºèªãƒ»UIè¨­å®šä¸­..."
    
    # UIæ”¹å–„è¨­å®š
    tmux set-option -g mouse on
    tmux set-option -g pane-border-status top
    tmux set-option -g pane-border-format '#[fg=colour15,bg=colour4,bold]#{?pane_active, ğŸ¯ ACTIVE ,}#[fg=colour7,bg=colour8]#{?pane_active,, STANDBY } #[fg=colour15,bold]#{pane_title}#[default]'
    
    # ãƒšã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«è¨­å®šï¼ˆé€£æºçŠ¶æ³è¡¨ç¤ºï¼‰
    tmux select-pane -t president:0 -T "ğŸ‘‘ PRESIDENTãƒ»çµ±æ‹¬è²¬ä»»è€… [âœ… é€£æºå®Œäº†]"
    tmux select-pane -t multiagent:0.0 -T "ğŸ‘” BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ [âœ… é€£æºå®Œäº†]"
    tmux select-pane -t multiagent:0.1 -T "ğŸ’» WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ [âœ… é€£æºå®Œäº†]"
    tmux select-pane -t multiagent:0.2 -T "ğŸ”§ WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ [âœ… é€£æºå®Œäº†]"
    tmux select-pane -t multiagent:0.3 -T "ğŸ¨ WORKER3ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ [âœ… é€£æºå®Œäº†]"
    
    # å®Œå…¨è‡ªå‹•å®Ÿè¡Œç›£è¦–ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
    log_info "ğŸš€ é€£æºç¢ºèªæ¸ˆã¿è‡ªå‹•å®Ÿè¡Œç›£è¦–ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ä¸­..."
    start_perfect_auto_execute_monitor &
    
    log_success "ğŸ‰ Claude Authé€£æºã‚¿ã‚¤ãƒŸãƒ³ã‚°å®Œå…¨è¦‹ç›´ã—ç‰ˆã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†ï¼"
    echo ""
    echo "ğŸ¯ é€£æºç¢ºèªå®Œäº†:"
    echo "  âœ… PRESIDENT: èµ·å‹•ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±•é–‹ãƒ»å‡¦ç†å®Œäº†"
    echo "  âœ… å…¨WORKER: èµ·å‹•ãƒ»å—ä¿¡ãƒ»å½¹å‰²è¨­å®šå®Œäº†"
    echo "  âœ… è‡ªå‹•å®Ÿè¡Œç›£è¦–: èµ·å‹•æ¸ˆã¿"
    echo ""
    echo "ğŸ“‹ ä½¿ç”¨æ–¹æ³•:"
    echo "  - presidentã‚»ãƒƒã‚·ãƒ§ãƒ³: tmux attach-session -t president"
    echo "  - multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³: tmux attach-session -t multiagent"
    echo ""
    
    # PRESIDENTç”»é¢ã«è‡ªå‹•æ¥ç¶š
    log_info "ğŸ‘‘ PRESIDENTç”»é¢ã«è‡ªå‹•æ¥ç¶šä¸­..."
    tmux attach-session -t president
}

# ğŸ“± å‹•çš„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°æ©Ÿèƒ½
setup_dynamic_status_updates() {
    nohup bash -c '
        exec > /tmp/ai-agents-status-updates.log 2>&1
        echo "$(date): å‹•çš„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°æ©Ÿèƒ½é–‹å§‹"
        
        while true; do
            # ğŸ” å„ãƒšã‚¤ãƒ³ã®æ´»å‹•çŠ¶æ³ã‚’ç›£è¦–
            active_count=0
            
            # PRESIDENTçŠ¶æ³ãƒã‚§ãƒƒã‚¯
            if tmux capture-pane -t president -p 2>/dev/null | grep -qE "Please let me know|How can I help|What would you like" 2>/dev/null; then
                tmux select-pane -t president:0 -T "ğŸ‘‘ PRESIDENTãƒ»æœ€é«˜è²¬ä»»è€… [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±æ‹¬ãƒ»æ„æ€æ±ºå®š] ğŸŸ¢ STATUS: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–å¯¾è©±ä¸­"
                ((active_count++))
            fi
            
            # å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã®çŠ¶æ³ãƒã‚§ãƒƒã‚¯
            for worker_id in {0..3}; do
                worker_content=$(tmux capture-pane -t multiagent:0.$worker_id -p 2>/dev/null || echo "")
                
                case $worker_id in
                    0) # BOSS
                        if echo "$worker_content" | grep -qE "Please let me know|How can I help|åˆ†æ|ãƒ¬ãƒãƒ¼ãƒˆ" 2>/dev/null; then
                            tmux select-pane -t multiagent:0.0 -T "ğŸ‘” BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ [ä½œæ¥­åˆ†æ‹…ãƒ»é€²æ—ç®¡ç†] ğŸŸ¢ STATUS: ãƒãƒ¼ãƒ æŒ‡å°ä¸­"
                            ((active_count++))
                        else
                            tmux select-pane -t multiagent:0.0 -T "ğŸ‘” BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ [ä½œæ¥­åˆ†æ‹…ãƒ»é€²æ—ç®¡ç†] ğŸŸ¡ STATUS: æŒ‡ç¤ºå¾…æ©Ÿä¸­"
                        fi
                        ;;
                    1) # WORKER1 - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
                        if echo "$worker_content" | grep -qE "Please let me know|React|Vue|CSS|HTML" 2>/dev/null; then
                            tmux select-pane -t multiagent:0.1 -T "ğŸ’» WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ [React/Vue/CSS] ğŸŸ¢ STATUS: UIå®Ÿè£…ä¸­"
                            ((active_count++))
                        else
                            tmux select-pane -t multiagent:0.1 -T "ğŸ’» WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ [React/Vue/CSS] ğŸŸ¡ STATUS: å®Ÿè£…å¾…æ©Ÿä¸­"
                        fi
                        ;;
                    2) # WORKER2 - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
                        if echo "$worker_content" | grep -qE "Please let me know|API|Node|Python|ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹" 2>/dev/null; then
                            tmux select-pane -t multiagent:0.2 -T "ğŸ”§ WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ [API/DB/ã‚µãƒ¼ãƒãƒ¼] ğŸŸ¢ STATUS: é–‹ç™ºä¸­"
                            ((active_count++))
                        else
                            tmux select-pane -t multiagent:0.2 -T "ğŸ”§ WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ [API/DB/ã‚µãƒ¼ãƒãƒ¼] ğŸŸ¡ STATUS: é–‹ç™ºå¾…æ©Ÿä¸­"
                        fi
                        ;;
                    3) # WORKER3 - ãƒ‡ã‚¶ã‚¤ãƒ³
                        if echo "$worker_content" | grep -qE "Please let me know|ãƒ‡ã‚¶ã‚¤ãƒ³|UI|UX|è¦–è¦š" 2>/dev/null; then
                            tmux select-pane -t multiagent:0.3 -T "ğŸ¨ WORKER3ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ [UX/UIè¨­è¨ˆãƒ»è¦–è¦šæ”¹å–„] ğŸŸ¢ STATUS: è¨­è¨ˆä¸­"
                            ((active_count++))
                        else
                            tmux select-pane -t multiagent:0.3 -T "ğŸ¨ WORKER3ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ [UX/UIè¨­è¨ˆãƒ»è¦–è¦šæ”¹å–„] ğŸŸ¡ STATUS: è¨­è¨ˆå¾…æ©Ÿä¸­"
                        fi
                        ;;
                esac
            done
            
            # ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ•°è¡¨ç¤ºï¼‰
            tmux rename-window -t president "ğŸ‘‘ PRESIDENT [æ´»å‹•çŠ¶æ³: $active_count/5]"
            tmux rename-window -t multiagent "ğŸ‘¥ AI-TEAM [ç¨¼åƒãƒ¡ãƒ³ãƒãƒ¼: $active_count/5]"
            
            # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³æ›´æ–°
            current_time=$(date "+%H:%M:%S")
            if [ $active_count -gt 0 ]; then
                tmux set-option -g status-left "#[bg=colour2,fg=colour15,bold] ğŸ¤– AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ  - $active_count ãƒ¡ãƒ³ãƒãƒ¼ç¨¼åƒä¸­ #[default]"
            else
                tmux set-option -g status-left "#[bg=colour3,fg=colour15,bold] ğŸ¤– AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ  - å…¨ãƒ¡ãƒ³ãƒãƒ¼å¾…æ©Ÿä¸­ #[default]"
            fi
            
            echo "$(date): ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°å®Œäº† - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: $active_count/5"
            
            # 15ç§’é–“éš”ã§æ›´æ–°ï¼ˆè»½é‡åŒ–ï¼‰
            sleep 15
        done
    ' &
}

# åˆæœŸåŒ–é–¢æ•°
init_dirs() {
    # å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
    mkdir -p "$LOGS_DIR" "$SESSIONS_DIR" "$INSTRUCTIONS_DIR" "$TMP_DIR"
    
    # ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    mkdir -p "$LOGS_DIR/ai-agents" "$LOGS_DIR/system"
}

# åŠè‡ªå‹•PRESIDENTèµ·å‹•ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚å¯¾å¿œï¼‰
setup_claude_semi_auto() {
    log_info "ğŸ¯ PRESIDENTåŠè‡ªå‹•èµ·å‹•ï¼ˆtmuxä½œæˆâ†’èªè¨¼æ‰‹å‹•ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è‡ªå‹•ã‚»ãƒƒãƒˆï¼‰"
    
    # Step1: tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•ä½œæˆ
    log_info "ğŸ“‹ ã€Step1ã€‘tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•ä½œæˆä¸­..."
    launch_tmux_sessions
    sleep 1
    log_success "âœ… tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³è‡ªå‹•ä½œæˆå®Œäº†"
    
    echo ""
    log_info "ğŸ“‹ ã€Step2ã€‘PRESIDENTèµ·å‹• - é¸æŠè‚¢åŠè‡ªå‹•é€²è¡Œ"
    log_info "ğŸ¯ Claude Codeèµ·å‹•ä¸­...ï¼ˆèªè¨¼ã¯æ‰‹å‹•ã§è¡Œã£ã¦ãã ã•ã„ï¼‰"
    tmux send-keys -t president 'claude --dangerously-skip-permissions' C-m
    
    # ãƒ†ãƒ¼ãƒé¸æŠè‡ªå‹•åŒ–ï¼ˆ3ç§’å¾Œã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠï¼‰
    sleep 3
    log_info "ğŸ¨ ãƒ†ãƒ¼ãƒé¸æŠè‡ªå‹•åŒ–ä¸­..."
    tmux send-keys -t president C-m  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠï¼ˆDark modeï¼‰
    
    # èªè¨¼æ–¹æ³•é¸æŠè‡ªå‹•åŒ–ï¼ˆ3ç§’å¾Œã«Claude accounté¸æŠï¼‰
    sleep 3
    log_info "ğŸ” èªè¨¼æ–¹æ³•é¸æŠè‡ªå‹•åŒ–ä¸­..."
    tmux send-keys -t president C-m  # Claude account with subscriptioné¸æŠ
    
    # API Keyç«¶åˆé¸æŠè‡ªå‹•åŒ–ï¼ˆ3ç§’å¾Œã«Noé¸æŠï¼‰
    sleep 3
    log_info "ğŸ”‘ API Keyç«¶åˆé¸æŠè‡ªå‹•åŒ–ä¸­..."
    tmux send-keys -t president C-m  # No (recommended)é¸æŠ
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèªè‡ªå‹•åŒ–ï¼ˆ3ç§’å¾Œã«Enterï¼‰
    sleep 3
    log_info "ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèªè‡ªå‹•åŒ–ä¸­..."
    tmux send-keys -t president C-m  # Press Enter to continue
    
    # ã‚¿ãƒ¼ãƒŸãƒŠãƒ«è¨­å®šè‡ªå‹•åŒ–ï¼ˆ3ç§’å¾Œã«Yesé¸æŠï¼‰
    sleep 3
    log_info "ğŸ’» ã‚¿ãƒ¼ãƒŸãƒŠãƒ«è¨­å®šè‡ªå‹•åŒ–ä¸­..."
    tmux send-keys -t president C-m  # Yes, use recommended settings
    
    # Bypass Permissionsç¢ºèªè‡ªå‹•åŒ–ï¼ˆ3ç§’å¾Œã«ä¸‹çŸ¢å°â†’Enterï¼‰
    sleep 3
    log_info "âš ï¸ Bypass Permissionsç¢ºèªè‡ªå‹•åŒ–ä¸­..."
    tmux send-keys -t president Down C-m  # Yes, I accepté¸æŠ
    
    # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§Claude Codeèµ·å‹•ã‚’ç›£è¦–ã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªå‹•ã‚»ãƒƒãƒˆ
    run_semi_auto_background &
    
    echo ""
    echo "ğŸ“‹ ã€å‹•ä½œä»•æ§˜ã€‘åŠè‡ªå‹•ã‚·ã‚¹ãƒ†ãƒ :"
    echo "  1ï¸âƒ£ ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆèµ·å‹•: é¸æŠè‚¢åŠè‡ªå‹•é€²è¡Œ"
    echo "  2ï¸âƒ£ èªè¨¼: æ‰‹å‹•ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¡Œã†ï¼‰"
    echo "  3ï¸âƒ£ Claude Codeç«‹ã¡ä¸ŠãŒã‚Šæ™‚: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è‡ªå‹•ã‚»ãƒƒãƒˆ"
    echo "  4ï¸âƒ£ é€ä¿¡: æ‰‹å‹•ï¼ˆEnterã‚­ãƒ¼ï¼‰"
    echo "  5ï¸âƒ£ ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•å¾Œ: å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è‡ªå‹•ã‚»ãƒƒãƒˆ"
    echo "  6ï¸âƒ£ 4ç”»é¢ç¢ºèª: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2ã§æ‰‹å‹•å®Ÿè¡Œ"
    echo ""
    echo "ğŸ”¹ ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã€‘:"
    echo "  - Claude Codeèªè¨¼å®Œäº†å¾Œã€PRESIDENTãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè‡ªå‹•ã‚»ãƒƒãƒˆã•ã‚Œã¾ã™"
    echo "  - Enterã‚­ãƒ¼ã§é€ä¿¡ã—ã¦ãã ã•ã„ï¼ˆæ‰‹å‹•ï¼‰"
    echo "  - ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•å¾Œã€å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè‡ªå‹•ã‚»ãƒƒãƒˆã•ã‚Œã¾ã™"
    echo "  - åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§: tmux attach-session -t multiagent"
    echo ""
    
    # PRESIDENTç”»é¢ã«ã‚¢ã‚¿ãƒƒãƒ
    log_info "ğŸ‘‘ PRESIDENTç”»é¢ã«æ¥ç¶šä¸­...ï¼ˆèªè¨¼ã¯æ‰‹å‹•ã§è¡Œã£ã¦ãã ã•ã„ï¼‰"
    tmux attach-session -t president
}

# æ‰‹å‹•4ç”»é¢èµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ï¼‰
manual_multiagent_start() {
    log_info "ğŸ”§ æ‰‹å‹•4ç”»é¢èµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ï¼‰"
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
    if ! tmux has-session -t multiagent 2>/dev/null; then
        log_error "âŒ multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å…ˆã«èµ·å‹•ã—ã¦ãã ã•ã„:"
        echo "  ./ai-agents/manage.sh start"
        return 1
    fi
    
    log_info "ğŸ‘¥ æ‰‹å‹•4ç”»é¢èµ·å‹•ä¸­..."
    
    # æ¨©é™ã‚¹ã‚­ãƒƒãƒ—ã§èµ·å‹•
    for i in {0..3}; do 
        tmux send-keys -t multiagent:0.$i 'printf "2\\n" | claude --dangerously-skip-permissions < /dev/null' C-m
        sleep 0.5
    done
    
    log_success "âœ… æ‰‹å‹•4ç”»é¢èµ·å‹•å®Œäº†"
    echo ""
}

# ğŸš€ ãƒ¯ãƒ¼ã‚«ãƒ¼å¼·åˆ¶èµ·å‹•æ©Ÿèƒ½ï¼ˆç¢ºå®Ÿæ€§é‡è¦–ï¼‰
force_start_workers() {
    log_info "ğŸš€ ãƒ¯ãƒ¼ã‚«ãƒ¼å¼·åˆ¶èµ·å‹•æ©Ÿèƒ½ï¼ˆç¢ºå®Ÿæ€§é‡è¦–ï¼‰"
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
    if ! tmux has-session -t multiagent 2>/dev/null; then
        log_error "âŒ multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å…ˆã«èµ·å‹•ã—ã¦ãã ã•ã„:"
        echo "  ./ai-agents/manage.sh start"
        return 1
    fi
    
    log_info "ğŸ”„ å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã®èµ·å‹•çŠ¶æ³ã‚’ç¢ºèªä¸­..."
    
    # å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã®çŠ¶æ³ç¢ºèªã¨å¼·åˆ¶èµ·å‹•
    for i in {0..3}; do
        log_info "ğŸ“‹ WORKER${i} çŠ¶æ³ç¢ºèªä¸­..."
        
        # ç¾åœ¨ã®çŠ¶æ³ã‚’å–å¾—
        worker_content=$(tmux capture-pane -t multiagent:0.$i -p 2>/dev/null || echo "")
        
        if echo "$worker_content" | grep -q "Welcome to Claude Code\|Please let me know" 2>/dev/null; then
            log_success "âœ… WORKER${i} æ—¢ã«èµ·å‹•æ¸ˆã¿"
        else
            log_warn "âš ï¸ WORKER${i} æœªèµ·å‹• - å¼·åˆ¶èµ·å‹•å®Ÿè¡Œä¸­..."
            
            # å¼·åˆ¶èµ·å‹•ï¼ˆè¤‡æ•°æ‰‹æ³•ã§ç¢ºå®Ÿæ€§å‘ä¸Šï¼‰
            tmux send-keys -t multiagent:0.$i C-c  # ç¾åœ¨ã®å‡¦ç†ã‚’ã‚¯ãƒªã‚¢
            sleep 0.5
            tmux send-keys -t multiagent:0.$i "claude --dangerously-skip-permissions" C-m
            sleep 2
            
            # Bypass Permissionsè‡ªå‹•é¸æŠ
            tmux send-keys -t multiagent:0.$i "2" C-m
            sleep 1
            
            log_info "â³ WORKER${i} èµ·å‹•å®Œäº†å¾…æ©Ÿä¸­..."
            
            # èµ·å‹•å®Œäº†ç¢ºèªï¼ˆæœ€å¤§30ç§’ï¼‰
            for j in {1..60}; do
                worker_check=$(tmux capture-pane -t multiagent:0.$i -p 2>/dev/null || echo "")
                if echo "$worker_check" | grep -q "Welcome to Claude Code" 2>/dev/null; then
                    log_success "âœ… WORKER${i} èµ·å‹•å®Œäº†ç¢ºèª (${j}/60ç§’)"
                    
                    # ğŸ”§ å½¹å‰²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è‡ªå‹•é€ä¿¡ï¼ˆã€Œ2ã€æ··å…¥å•é¡Œä¿®æ­£ã€ã€Œ>ã€ä»˜ãã§è‡ªå‹•å®Ÿè¡Œå¯¾å¿œï¼‰
                    case $i in
                        0) role_msg=">ã‚ãªãŸã¯BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ã§ã™ã€‚./ai-agents/instructions/boss.md ã‚’å‚ç…§ã—ã¦æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" ;;
                        1) role_msg=">ã‚ãªãŸã¯WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚./ai-agents/instructions/worker.md ã‚’å‚ç…§ã—ã¦æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" ;;
                        2) role_msg=">ã‚ãªãŸã¯WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚./ai-agents/instructions/worker.md ã‚’å‚ç…§ã—ã¦æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" ;;
                        3) role_msg=">ã‚ãªãŸã¯WORKER3ãƒ»UI/UXãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã§ã™ã€‚./ai-agents/instructions/worker.md ã‚’å‚ç…§ã—ã¦æ—¥æœ¬èªã§å¿œç­”ã—ã¦ãã ã•ã„ã€‚" ;;
                    esac
                    
                    # ğŸš« Bypass Permissionsé¸æŠã®ã€Œ2ã€ãŒæ··å…¥ã—ãªã„ã‚ˆã†ã€ååˆ†ãªå¾…æ©Ÿæ™‚é–“ã‚’ç¢ºä¿
                    sleep 2
                    tmux send-keys -t multiagent:0.$i "$role_msg" C-m
                    log_success "âœ… WORKER${i} å½¹å‰²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å®Œäº†"
                    break
                fi
                sleep 0.5
            done
            
            if [ $j -eq 60 ]; then
                log_error "âŒ WORKER${i} èµ·å‹•ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ30ç§’ï¼‰"
            fi
        fi
        
        echo ""
    done
    
    log_success "ğŸ‰ ãƒ¯ãƒ¼ã‚«ãƒ¼å¼·åˆ¶èµ·å‹•å‡¦ç†å®Œäº†"
    echo ""
    echo "ğŸ“‹ ç¢ºèªæ–¹æ³•:"
    echo "  tmux attach-session -t multiagent"
    echo ""
}

# ğŸ¨ ãƒãƒ¼ãƒ UIå¾©æ—§æ©Ÿèƒ½ï¼ˆç·Šæ€¥ç”¨ï¼‰
restore_team_ui() {
    log_info "ğŸ¨ ãƒãƒ¼ãƒ UIå¾©æ—§æ©Ÿèƒ½ï¼ˆç·Šæ€¥ç”¨ï¼‰"
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
    if ! tmux has-session -t multiagent 2>/dev/null; then
        log_error "âŒ multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å…ˆã«èµ·å‹•ã—ã¦ãã ã•ã„:"
        echo "  ./ai-agents/manage.sh start"
        return 1
    fi
    
    if ! tmux has-session -t president 2>/dev/null; then
        log_error "âŒ presidentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å…ˆã«èµ·å‹•ã—ã¦ãã ã•ã„:"
        echo "  ./ai-agents/manage.sh start"
        return 1
    fi
    
    log_info "ğŸ–±ï¸ ãƒã‚¦ã‚¹æ©Ÿèƒ½ã¨ãƒœãƒ¼ãƒ€ãƒ¼è¨­å®šä¸­..."
    
    # ğŸ–±ï¸ å¼·åŒ–ã•ã‚ŒãŸtmuxè¦–è¦šè¨­å®šï¼ˆã‚¯ãƒªãƒƒã‚¯ç§»å‹•å¯¾å¿œï¼‰
    tmux set-option -g mouse on
    tmux set-option -g pane-border-status top
    tmux set-option -g pane-border-style "fg=colour8"
    tmux set-option -g pane-active-border-style "fg=colour4,bold"
    
    # ğŸ¨ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒšã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆå¸¸æ™‚è¦‹ã‚„ã™ãè¡¨ç¤ºï¼‰
    tmux set-option -g pane-border-format '#[fg=colour15,bg=colour4,bold]#{?pane_active, ğŸ¯ ACTIVE ,}#[fg=colour7,bg=colour8]#{?pane_active,, STANDBY } #[fg=colour15,bold]#{pane_title}#[default]'
    
    log_info "ğŸ“Š æ—¥æœ¬èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³è¨­å®šä¸­..."
    
    # ğŸ“Š æ—¥æœ¬èªå¯¾å¿œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ï¼‰
    tmux set-option -g status-left-length 100
    tmux set-option -g status-right-length 100
    tmux set-option -g status-left "#[bg=colour2,fg=colour15,bold] ğŸ¤– AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­ â”‚ 5åã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå”èª¿ä½œæ¥­ #[default]"
    tmux set-option -g status-right "#[bg=colour4,fg=colour15] ğŸ• %H:%M:%S â”‚ ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ãƒšã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ç§»å‹•å¯èƒ½ #[default]"
    tmux set-option -g status-interval 1
    
    log_info "ğŸ·ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªå½¹è·ãƒ»è·ç¨®è¡¨ç¤ºè¨­å®šä¸­..."
    
    # ğŸ·ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªå½¹è·è¡¨ç¤ºï¼ˆå¸¸æ™‚è¦‹ã‚„ã™ãï¼‰
    tmux select-pane -t president:0 -T "ğŸ‘‘ çµ±æ‹¬è²¬ä»»è€…ãƒ»PRESIDENT â”‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ç®¡ç†ãƒ»æ„æ€æ±ºå®š â”‚ ğŸŸ¢ ç¨¼åƒä¸­"
    tmux select-pane -t multiagent:0.0 -T "ğŸ‘” ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ãƒ»BOSS â”‚ ä½œæ¥­åˆ†æ‹…ãƒ»é€²æ—ç®¡ç†ãƒ»å“è³ªç¢ºä¿ â”‚ ğŸŸ¡ å¾…æ©Ÿä¸­"
    tmux select-pane -t multiagent:0.1 -T "ğŸ’» ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»WORKER1 â”‚ Reactãƒ»Vueãƒ»CSSãƒ»UIå®Ÿè£… â”‚ ğŸŸ¡ å¾…æ©Ÿä¸­"
    tmux select-pane -t multiagent:0.2 -T "ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»WORKER2 â”‚ APIãƒ»DBãƒ»ã‚µãƒ¼ãƒãƒ¼å‡¦ç† â”‚ ğŸŸ¡ å¾…æ©Ÿä¸­"
    tmux select-pane -t multiagent:0.3 -T "ğŸ¨ UI/UXãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ãƒ»WORKER3 â”‚ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ â”‚ ğŸŸ¡ å¾…æ©Ÿä¸­"
    
    log_info "ğŸ–¥ï¸ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¿ã‚¤ãƒˆãƒ«è¨­å®šä¸­..."
    
    # ğŸ–¥ï¸ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¿ã‚¤ãƒˆãƒ«ã‚‚è¨­å®šï¼ˆãƒãƒ¼ãƒ æ§‹æˆè¡¨ç¤ºï¼‰
    tmux rename-window -t president "ğŸ‘‘ PRESIDENT [1/5 ACTIVE]"
    tmux rename-window -t multiagent "ğŸ‘¥ AI-TEAM [4/5 MEMBERS]"
    
    log_success "ğŸ‰ ãƒãƒ¼ãƒ UIå¾©æ—§å®Œäº†ï¼"
    echo ""
    echo "ğŸ“‹ ç¢ºèªæ–¹æ³•:"
    echo "  tmux attach-session -t multiagent  # 4ç”»é¢ãƒãƒ¼ãƒ ç¢ºèª"
    echo "  tmux attach-session -t president   # PRESIDENTç¢ºèª"
    echo ""
    echo "ğŸ¯ ç‰¹å¾´:"
    echo "  âœ… ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯ç§»å‹•å¯¾å¿œ"
    echo "  âœ… è©³ç´°ãªå½¹è·ãƒ»è·ç¨®è¡¨ç¤º"
    echo "  âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ™‚åˆ»è¡¨ç¤º"
    echo "  âœ… ã‚«ãƒ©ãƒ¼ä»˜ãã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º"
    echo ""
}

# ğŸš€ è‡ªå‹•å®Ÿè¡Œç›£è¦–æ©Ÿèƒ½ï¼ˆAIçµ„ç¹”é§†å‹•ä¸­ï¼‰
start_auto_execute_monitor() {
    log_info "ğŸš€ è‡ªå‹•å®Ÿè¡Œç›£è¦–æ©Ÿèƒ½é–‹å§‹ï¼ˆAIçµ„ç¹”é§†å‹•ä¸­ï¼‰"
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
    if ! tmux has-session -t multiagent 2>/dev/null; then
        log_error "âŒ multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å…ˆã«èµ·å‹•ã—ã¦ãã ã•ã„:"
        echo "  ./ai-agents/manage.sh start"
        return 1
    fi
    
    log_info "ğŸ” ãƒ¯ãƒ¼ã‚«ãƒ¼ã®æŒ‡ç¤ºç›£è¦–ã‚’é–‹å§‹ã—ã¾ã™..."
    echo "ğŸ“‹ ç›£è¦–å¯¾è±¡:"
    echo "  ğŸ‘” BOSS (multiagent:0.0)"
    echo "  ğŸ’» WORKER1 (multiagent:0.1)" 
    echo "  ğŸ”§ WORKER2 (multiagent:0.2)"
    echo "  ğŸ¨ WORKER3 (multiagent:0.3)"
    echo ""
    echo "ğŸ’¡ å‹•ä½œ: Claude Codeã®æŒ‡ç¤ºã«æ–‡ç« ãŒå…¥ã£ãŸã‚‰å³åº§ã«è‡ªå‹•å®Ÿè¡Œï¼ˆEnterã‚­ãƒ¼é€ä¿¡ï¼‰"
    echo "ğŸ›‘ åœæ­¢: Ctrl+C"
    echo ""
    
    # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è‡ªå‹•å®Ÿè¡Œç›£è¦–ã‚’é–‹å§‹
    nohup bash -c '
        exec > /tmp/ai-agents-auto-execute.log 2>&1
        echo "$(date): è‡ªå‹•å®Ÿè¡Œç›£è¦–é–‹å§‹"
        
        # å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã®å‰å›ã®ç”»é¢å†…å®¹ã‚’ä¿å­˜
        declare -A prev_content
        for worker_id in {0..3}; do
            prev_content[$worker_id]=$(tmux capture-pane -t multiagent:0.$worker_id -p 2>/dev/null || echo "")
        done
        
        while true; do
            for worker_id in {0..3}; do
                # ç¾åœ¨ã®ç”»é¢å†…å®¹ã‚’å–å¾—
                current_content=$(tmux capture-pane -t multiagent:0.$worker_id -p 2>/dev/null || echo "")
                
                # å‰å›ã¨æ¯”è¼ƒã—ã¦æ–°ã—ã„æŒ‡ç¤ºãŒå…¥åŠ›ã•ã‚ŒãŸã‹ãƒã‚§ãƒƒã‚¯
                if [ "$current_content" != "${prev_content[$worker_id]}" ]; then
                    # æ–°ã—ã„å†…å®¹ã‚’ãƒã‚§ãƒƒã‚¯
                    new_lines=$(echo "$current_content" | tail -5)
                    
                    # è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã§æŒ‡ç¤ºæ¤œå‡ºï¼ˆã‚ˆã‚Šç¢ºå®Ÿãªè‡ªå‹•å®Ÿè¡Œï¼‰
                    should_execute=false
                    
                    # ãƒ‘ã‚¿ãƒ¼ãƒ³1: ã€Œ>ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹
                    if echo "$new_lines" | grep -qE "^> .+" 2>/dev/null; then
                        should_execute=true
                        echo "$(date): WORKER${worker_id} ãƒ‘ã‚¿ãƒ¼ãƒ³1æ¤œå‡º: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›"
                    fi
                    
                    # ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã‹ã‚‰ã®æŒ‡ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¤œå‡º
                    if echo "$current_content" | grep -qE "(æŒ‡ç¤ºã‚’é€ä¿¡|ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æŒ‡ç¤º|ã‚¿ã‚¹ã‚¯ã‚’|ä½œæ¥­ã‚’|å®Ÿè¡Œã—ã¦)" 2>/dev/null; then
                        should_execute=true
                        echo "$(date): WORKER${worker_id} ãƒ‘ã‚¿ãƒ¼ãƒ³2æ¤œå‡º: ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆæŒ‡ç¤º"
                    fi
                    
                    # ãƒ‘ã‚¿ãƒ¼ãƒ³3: å…¥åŠ›å¾…ã¡çŠ¶æ…‹ã§ã®æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
                    if echo "$current_content" | tail -1 | grep -qE "^>" 2>/dev/null && [ ${#current_content} -gt ${#prev_content[$worker_id]} ]; then
                        should_execute=true
                        echo "$(date): WORKER${worker_id} ãƒ‘ã‚¿ãƒ¼ãƒ³3æ¤œå‡º: å…¥åŠ›å¾…ã¡çŠ¶æ…‹å¤‰åŒ–"
                    fi
                    
                    if [ "$should_execute" = true ]; then
                        echo "$(date): WORKER${worker_id} æ–°ã—ã„æŒ‡ç¤ºæ¤œå‡º - è‡ªå‹•å®Ÿè¡Œé–‹å§‹"
                        
                        # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                        case $worker_id in
                            0) tmux select-pane -t multiagent:0.0 -T "ğŸ‘” ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ãƒ»BOSS â”‚ ä½œæ¥­åˆ†æ‹…ãƒ»é€²æ—ç®¡ç†ãƒ»å“è³ªç¢ºä¿ â”‚ ğŸŸ¢ å®Ÿè¡Œä¸­" ;;
                            1) tmux select-pane -t multiagent:0.1 -T "ğŸ’» ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»WORKER1 â”‚ Reactãƒ»Vueãƒ»CSSãƒ»UIå®Ÿè£… â”‚ ğŸŸ¢ å®Ÿè¡Œä¸­" ;;
                            2) tmux select-pane -t multiagent:0.2 -T "ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»WORKER2 â”‚ APIãƒ»DBãƒ»ã‚µãƒ¼ãƒãƒ¼å‡¦ç† â”‚ ğŸŸ¢ å®Ÿè¡Œä¸­" ;;
                            3) tmux select-pane -t multiagent:0.3 -T "ğŸ¨ UI/UXãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ãƒ»WORKER3 â”‚ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ â”‚ ğŸŸ¢ å®Ÿè¡Œä¸­" ;;
                        esac
                        
                        # ç¢ºå®ŸãªEnterã‚­ãƒ¼é€ä¿¡ï¼ˆè¤‡æ•°å›è©¦è¡Œï¼‰
                        echo "$(date): WORKER${worker_id} Enterã‚­ãƒ¼é€ä¿¡é–‹å§‹"
                        
                        # æ–¹æ³•1: é€šå¸¸ã®Enterã‚­ãƒ¼é€ä¿¡
                        tmux send-keys -t multiagent:0.$worker_id C-m
                        sleep 0.5
                        
                        # æ–¹æ³•2: ç¢ºå®Ÿæ€§ã®ãŸã‚å†åº¦é€ä¿¡
                        tmux send-keys -t multiagent:0.$worker_id ""
                        tmux send-keys -t multiagent:0.$worker_id C-m
                        sleep 0.5
                        
                        # æ–¹æ³•3: å¼·åˆ¶çš„ãªæ”¹è¡Œé€ä¿¡
                        tmux send-keys -t multiagent:0.$worker_id Enter
                        
                        echo "$(date): WORKER${worker_id} Enterã‚­ãƒ¼é€ä¿¡å®Œäº†"
                        
                        # 3ç§’å¾Œã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å¾…æ©Ÿä¸­ã«æˆ»ã™
                        sleep 3
                        case $worker_id in
                            0) tmux select-pane -t multiagent:0.0 -T "ğŸ‘” ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ãƒ»BOSS â”‚ ä½œæ¥­åˆ†æ‹…ãƒ»é€²æ—ç®¡ç†ãƒ»å“è³ªç¢ºä¿ â”‚ ğŸŸ¡ å¾…æ©Ÿä¸­" ;;
                            1) tmux select-pane -t multiagent:0.1 -T "ğŸ’» ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»WORKER1 â”‚ Reactãƒ»Vueãƒ»CSSãƒ»UIå®Ÿè£… â”‚ ğŸŸ¡ å¾…æ©Ÿä¸­" ;;
                            2) tmux select-pane -t multiagent:0.2 -T "ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»WORKER2 â”‚ APIãƒ»DBãƒ»ã‚µãƒ¼ãƒãƒ¼å‡¦ç† â”‚ ğŸŸ¡ å¾…æ©Ÿä¸­" ;;
                            3) tmux select-pane -t multiagent:0.3 -T "ğŸ¨ UI/UXãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ãƒ»WORKER3 â”‚ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ â”‚ ğŸŸ¡ å¾…æ©Ÿä¸­" ;;
                        esac
                    fi
                    
                    # å‰å›ã®å†…å®¹ã‚’æ›´æ–°
                    prev_content[$worker_id]="$current_content"
                fi
            done
            
            # 15ç§’é–“éš”ã§è»½é‡ç›£è¦–ï¼ˆåŠ¹ç‡çš„ãªæ¤œå‡ºï¼‰
            sleep 15
        done
    ' &
    
    AUTO_EXECUTE_PID=$!
    echo $AUTO_EXECUTE_PID > /tmp/ai-agents-auto-execute.pid
    
    log_success "âœ… è‡ªå‹•å®Ÿè¡Œç›£è¦–æ©Ÿèƒ½ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼ˆPID: $AUTO_EXECUTE_PIDï¼‰"
    echo ""
    echo "ğŸ“‹ ç›£è¦–ãƒ­ã‚°ç¢ºèª:"
    echo "  tail -f /tmp/ai-agents-auto-execute.log"
    echo ""
    echo "ğŸ›‘ åœæ­¢æ–¹æ³•:"
    echo "  kill $AUTO_EXECUTE_PID"
    echo "  ã¾ãŸã¯ ./ai-agents/manage.sh stop-auto-execute"
    echo ""
}

# ğŸ›‘ è‡ªå‹•å®Ÿè¡Œç›£è¦–åœæ­¢æ©Ÿèƒ½
stop_auto_execute_monitor() {
    log_info "ğŸ›‘ è‡ªå‹•å®Ÿè¡Œç›£è¦–åœæ­¢ä¸­..."
    
    if [ -f /tmp/ai-agents-auto-execute.pid ]; then
        AUTO_EXECUTE_PID=$(cat /tmp/ai-agents-auto-execute.pid)
        if kill $AUTO_EXECUTE_PID 2>/dev/null; then
            log_success "âœ… è‡ªå‹•å®Ÿè¡Œç›£è¦–ã‚’åœæ­¢ã—ã¾ã—ãŸï¼ˆPID: $AUTO_EXECUTE_PIDï¼‰"
            rm -f /tmp/ai-agents-auto-execute.pid
        else
            log_warn "âš ï¸ ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆPID: $AUTO_EXECUTE_PIDï¼‰ã¯æ—¢ã«åœæ­¢ã—ã¦ã„ã¾ã™"
        fi
    else
        log_warn "âš ï¸ è‡ªå‹•å®Ÿè¡Œç›£è¦–ã¯é–‹å§‹ã•ã‚Œã¦ã„ã¾ã›ã‚“"
    fi
    echo ""
}

# .claudeè¨­å®šç¢ºèªãƒ»ç”Ÿæˆæ©Ÿèƒ½
setup_claude_local_config() {
    log_info "ğŸ”§ .claudeè¨­å®šã®ç¢ºèªãƒ»ç”Ÿæˆæ©Ÿèƒ½"
    
    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ç§»å‹•
    cd "$(dirname "$(dirname "$0")")"
    
    if [ -d ".claude" ] && [ -f ".claude/CLAUDE.md" ]; then
        log_success "âœ… .claudeè¨­å®šã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™"
        echo ""
        echo "ğŸ“ æ—¢å­˜ã®.claudeè¨­å®š:"
        ls -la .claude/
        echo ""
        read -p ".claudeè¨­å®šã‚’å†ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ [y/N]: " regenerate
        
        if [[ ! $regenerate =~ ^[Yy]$ ]]; then
            log_info "è¨­å®šç”Ÿæˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ"
            return 0
        fi
    fi
    
    log_info "ğŸ”„ .claudeè¨­å®šã‚’ç”Ÿæˆä¸­..."
    
    # .claudeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    mkdir -p .claude
    
    # Claude Codeè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ
    cat > .claude/claude_desktop_config.json << 'EOF'
{
  "name": "AIé–‹ç™ºæ”¯æ´ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
  "description": "AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ  + Cursoré€£æºé–‹ç™ºç’°å¢ƒ",
  "rules": [
    "æ—¥æœ¬èªã§ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³",
    "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æ±‚ã‚’æœ€å„ªå…ˆ",
    "æ©Ÿèƒ½ã‚’å‹æ‰‹ã«å¤‰æ›´ã—ãªã„",
    "AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã‚’ä¿æŒ"
  ],
  "memory": {
    "sync_with_cursor": true,
    "track_changes": true,
    "preserve_context": true,
    "ai_organization": true
  },
  "tools": {
    "enabled": true,
    "auto_bypass_permissions": true,
    "dangerous_commands": false,
    "tmux_integration": true
  }
}
EOF
    
    # CLAUDE.mdãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ
    cat > .claude/CLAUDE.md << 'EOF'
# Claude Code ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆAIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œï¼‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- **åå‰**: AIé–‹ç™ºæ”¯æ´ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- **ç›®çš„**: AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ  + Cursoré€£æºã«ã‚ˆã‚‹é©æ–°çš„é–‹ç™ºç’°å¢ƒ
- **è¨€èª**: æ—¥æœ¬èªãƒ¡ã‚¤ãƒ³
- **ç‰¹å¾´**: PRESIDENTã€BOSSã€WORKER ã«ã‚ˆã‚‹å”èª¿é–‹ç™º

## é‡è¦ãªãƒ«ãƒ¼ãƒ«
1. **æ—¥æœ¬èªã§ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: ã™ã¹ã¦ã®ã‚„ã‚Šå–ã‚Šã¯æ—¥æœ¬èªã§è¡Œã†
2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚æœ€å„ªå…ˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŒ‡ç¤ºã‚’æ­£ç¢ºã«ç†è§£ã—å®Ÿè¡Œã™ã‚‹
3. **æ©Ÿèƒ½ä¿æŒ**: æ—¢å­˜æ©Ÿèƒ½ã‚’å‹æ‰‹ã«å¤‰æ›´ãƒ»å‰Šé™¤ã—ãªã„
4. **AIçµ„ç¹”é€£æº**: AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ä¸€è²«æ€§ã‚’ä¿ã¤
5. **ã€Œ>ã€è‡ªå‹•å®Ÿè¡Œ**: æŒ‡ç¤ºã«ã¯ã€Œ>ã€ã‚’ä»˜ã‘ã¦è‡ªå‹•å®Ÿè¡Œå¯¾å¿œ

## AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
```
PRESIDENT (çµ±æ‹¬è²¬ä»»è€…)
    â†“
BOSS1 (ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼)
    â†“
WORKER1, WORKER2, WORKER3 (å®Ÿè¡Œæ‹…å½“)
```

## é‡è¦ãªã‚³ãƒãƒ³ãƒ‰
- **èµ·å‹•**: `./ai-agents/manage.sh auto`
- **åŠè‡ªå‹•èµ·å‹•**: `./ai-agents/manage.sh claude-auth`
- **çŠ¶æ³ç¢ºèª**: `./ai-agents/manage.sh status`
- **è¨­å®šç¢ºèª**: `./setup.sh s`

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 
```
.claude/
â”œâ”€â”€ claude_desktop_config.json  # Claude Codeè¨­å®š
â”œâ”€â”€ CLAUDE.md                   # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ project_context.md          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–‡è„ˆæƒ…å ±

ai-agents/
â”œâ”€â”€ manage.sh                   # AIçµ„ç¹”ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ instructions/               # AIå½¹å‰²å®šç¾©
â””â”€â”€ logs/                      # å‹•ä½œãƒ­ã‚°
```

## æ³¨æ„äº‹é …
- `.claude/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯.gitignoreã«è¿½åŠ ã•ã‚Œã¦ãŠã‚Šã€ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã®ã¿
- è¨­å®šã¯å„ç’°å¢ƒã§è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€æ‰‹å‹•ç·¨é›†ã¯éæ¨å¥¨
- æ›´æ–°æ™‚ã¯`./ai-agents/manage.sh setup-claude-config`ã§å†è¨­å®š
EOF
    
    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–‡è„ˆæƒ…å ±ã®ç”Ÿæˆ
    cat > .claude/project_context.md << 'EOF'
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–‡è„ˆæƒ…å ±

## ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: AIé–‹ç™ºæ”¯æ´ãƒ„ãƒ¼ãƒ«
- **ãƒ•ã‚§ãƒ¼ã‚º**: ç¶™ç¶šçš„æ”¹å–„ãƒ»é‹ç”¨
- **ä¸»è¦æŠ€è¡“**: Bash, AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ , tmux

## AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´
- **PRESIDENT**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±æ‹¬ã€æ„æ€æ±ºå®š
- **BOSS1**: ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ã€ä½œæ¥­åˆ†æ‹…ç®¡ç†
- **WORKER1-3**: å°‚é–€åˆ†é‡ã§ã®å®Ÿè¡Œæ‹…å½“

## é©æ–°çš„æ©Ÿèƒ½
- **ã€Œ>ã€è‡ªå‹•å®Ÿè¡Œ**: Claude Code ã®è‡ªå‹•å®Ÿè¡Œæ©Ÿèƒ½æ´»ç”¨
- **tmuxé€£æº**: ãƒãƒ«ãƒãƒšã‚¤ãƒ³ç®¡ç†ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
- **å‹•çš„UI**: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã¨ã‚¯ãƒªãƒƒã‚¯ç§»å‹•å¯¾å¿œ

## æœ€è¿‘ã®é‡è¦ãªæ”¹å–„
- AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨è‡ªå‹•åŒ–é”æˆ
- ã€Œ>ã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚‹è‡ªå‹•å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ 
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°æ©Ÿèƒ½
- .claudeè¨­å®šã®ãƒ­ãƒ¼ã‚«ãƒ«åŒ–å¯¾å¿œ

## é–‹ç™ºæ–¹é‡
1. **AIå”èª¿**: è¤‡æ•°AIã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªå”èª¿é–‹ç™º
2. **è‡ªå‹•åŒ–**: æ‰‹å‹•ä½œæ¥­ã®æœ€å°åŒ–
3. **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**: ç›´æ„Ÿçš„ãªæ“ä½œæ€§
4. **æ‹¡å¼µæ€§**: æ–°æ©Ÿèƒ½ã®è¿½åŠ å®¹æ˜“æ€§
EOF
    
    log_success "âœ… .claudeè¨­å®šç”Ÿæˆå®Œäº†ï¼"
    echo ""
    echo "ğŸ“ ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:"
    echo "   - .claude/claude_desktop_config.json"
    echo "   - .claude/CLAUDE.md"
    echo "   - .claude/project_context.md"
    echo ""
    echo "ğŸ¯ Claude Codeèµ·å‹•æ™‚ã«ã“ã‚Œã‚‰ã®è¨­å®šãŒè‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™"
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†ï¼ˆå‚ç…§ãƒªãƒã‚¸ãƒˆãƒªæº–æ‹ ï¼‰
main() {
    init_dirs
    
    case "${1:-help}" in
        # ğŸš€ å‚ç…§ãƒªãƒã‚¸ãƒˆãƒªæº–æ‹ ã®åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰
        "start")
            # tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆã®ã¿
            log_info "ğŸš€ tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆä¸­..."
            launch_tmux_sessions
            echo ""
                echo "ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è‡ªå‹•å®Ÿè¡Œä¸­..."
    echo "  1. PRESIDENTèªè¨¼ â†’ è‡ªå‹•å®Ÿè¡Œä¸­..."
    
    # è‡ªå‹•ã§PRESIDENTèªè¨¼å®Ÿè¡Œ
    if claude_auth_function; then
        echo "  âœ… PRESIDENTèªè¨¼å®Œäº†"
        echo ""
        echo "  2. multiagentèµ·å‹• â†’ è‡ªå‹•å®Ÿè¡Œä¸­..."
        
        # è‡ªå‹•ã§multiagentèµ·å‹•å®Ÿè¡Œï¼ˆè©²å½“ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚Œã°ï¼‰
        if command -v multiagent-start &> /dev/null || grep -q "multiagent-start" "$0"; then
            multiagent_start_function
            echo "  âœ… multiagentèµ·å‹•å®Œäº†"
        else
            echo "  ğŸ’¡ multiagentèµ·å‹•æ©Ÿèƒ½ã¯æ—¢ã«claude-authå†…ã§å®Ÿè¡Œæ¸ˆã¿"
        fi
        
        echo ""
        echo "ğŸ‰ å…¨ã‚¹ãƒ†ãƒƒãƒ—è‡ªå‹•å®Ÿè¡Œå®Œäº†ï¼"
        echo "ğŸ’¡ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼š"
        echo "   ./ai-agents/manage.sh president     # PRESIDENTç”»é¢"
        echo "   ./ai-agents/manage.sh multiagent    # 4äººãƒãƒ¼ãƒ ç”»é¢"
    else
        echo "  âŒ PRESIDENTèªè¨¼ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"
        echo "ğŸ’¡ æ‰‹å‹•å®Ÿè¡Œï¼š"
        echo "  ./ai-agents/manage.sh claude-auth     # PRESIDENTèªè¨¼"
        echo "  ./ai-agents/manage.sh multiagent      # multiagentç¢ºèª"
    fi
            echo ""
            ;;
        "claude-auth")
            # ã‚·ãƒ³ãƒ—ãƒ«èªè¨¼ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
            simple_claude_auth
            ;;
        "perfect-auto")
            # ğŸš€ å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–é–‹å§‹
            start_perfect_auto_execute_monitor
            ;;
        "stop-perfect-auto")
            # ğŸ›‘ å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–åœæ­¢
            stop_perfect_auto_execute
            ;;
        "auto")
            # ğŸš€ ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰èµ·å‹•ï¼ˆåˆå¿ƒè€…å‘ã‘è‡ªå‹•èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ä½¿ç”¨ï¼‰
            beginner_friendly_claude_auth
            ;;
        "multiagent-start")
            # multiagentä¸€æ‹¬èµ·å‹•ï¼ˆæ®µéš2ï¼‰
            manual_multiagent_start
            ;;
        "force-workers")
            # ğŸš€ ãƒ¯ãƒ¼ã‚«ãƒ¼å¼·åˆ¶èµ·å‹•ï¼ˆç·Šæ€¥ç”¨ï¼‰
            force_start_workers
            ;;
        "restore-ui")
            # ğŸ¨ ãƒãƒ¼ãƒ UIå¾©æ—§ï¼ˆç·Šæ€¥ç”¨ï¼‰
            restore_team_ui
            ;;
        "auto-execute")
            # ğŸš€ è‡ªå‹•å®Ÿè¡Œç›£è¦–é–‹å§‹ï¼ˆæ—§ç‰ˆï¼‰
            start_auto_execute_monitor
            ;;
        "stop-auto-execute")
            # ğŸ›‘ è‡ªå‹•å®Ÿè¡Œç›£è¦–åœæ­¢ï¼ˆæ—§ç‰ˆï¼‰
            stop_auto_execute_monitor
            ;;
        "setup-claude-config")
            # ğŸ”§ .claudeè¨­å®šè‡ªå‹•ç”Ÿæˆ
            setup_claude_local_config
            ;;
        "monitoring")
            # ğŸ” ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆçŠ¶æ³æŠŠæ¡ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹
            start_president_monitoring
            ;;
        "stop-monitoring")
            # ğŸ›‘ ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆçŠ¶æ³æŠŠæ¡ã‚·ã‚¹ãƒ†ãƒ åœæ­¢
            stop_president_monitoring
            ;;
        "log-check"|"logs")
            # ğŸ” é‡è¦ãƒ­ã‚°çµ±åˆç¢ºèªã‚·ã‚¹ãƒ†ãƒ 
            if [ -f "./ai-agents/log-check.sh" ]; then
                ./ai-agents/log-check.sh "${2:-all}"
            else
                log_error "âŒ log-check.sh ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            fi
            ;;
        "startup-check"|"startup")
            # ğŸš€ AIä½œæ¥­é–‹å§‹æ™‚çµ±åˆãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ï¼ˆAIå‘ã‘ï¼‰
            if [ -f "./ai-agents/startup-check.sh" ]; then
                ./ai-agents/startup-check.sh "${2:-full}"
            else
                log_error "âŒ startup-check.sh ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            fi
            ;;
        "start")
            # ğŸš€ AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ çµ±ä¸€èµ·å‹•ï¼ˆclaude-authã¨åŒã˜ï¼‰
            simple_claude_auth
            ;;
        "user-guide"|"guide")
            # ğŸ¯ åˆå¿ƒè€…å‘ã‘AIçµ„ç¹”ç«‹ã¡ä¸Šã’ã‚¬ã‚¤ãƒ‰ï¼ˆäººé–“å‘ã‘ï¼‰
            if [ -f "./ai-agents/user-guide.sh" ]; then
                ./ai-agents/user-guide.sh "${2:-full}"
            else
                log_error "âŒ user-guide.sh ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            fi
            ;;
        "president")  
            # PRESIDENTç”»é¢ã‚¢ã‚¿ãƒƒãƒ
            if tmux has-session -t president 2>/dev/null; then
                tmux attach-session -t president
            else
                log_error "âŒ presidentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å…ˆã« './ai-agents/manage.sh claude-auth' ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„"
            fi
            ;;
        "multiagent")
            # multiagentç”»é¢ã‚¢ã‚¿ãƒƒãƒ
            if tmux has-session -t multiagent 2>/dev/null; then
                tmux attach-session -t multiagent
            else
                log_error "âŒ multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å…ˆã« './ai-agents/manage.sh claude-auth' ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„"
            fi
            ;;
        "clean")
            # ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤
            clean_sessions
            ;;
        # ğŸ”§ è©³ç´°ã‚³ãƒãƒ³ãƒ‰ï¼ˆå¿…è¦æ™‚ã®ã¿ï¼‰
        "quick-start")
            quick_start
            ;;
        "claude-setup")
            setup_claude_code
            ;;
        "status")
            system_status
            ;;
        "help"|"--help"|"-h"|*)
            echo "ğŸ¤– AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨å¾©æ—§ç‰ˆ"
            echo "============================"
            echo ""
            echo "ğŸš€ AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•:"
            echo "  ./ai-agents/manage.sh start              # AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ï¼ˆæ¨å¥¨ï¼‰"
            echo "  ./ai-agents/manage.sh start --guide      # ã‚¬ã‚¤ãƒ‰ä»˜ãèµ·å‹•ï¼ˆåˆå¿ƒè€…å‘ã‘ï¼‰"
            echo "  ./ai-agents/manage.sh claude-auth        # å¾“æ¥ã®èµ·å‹•æ–¹æ³•ï¼ˆäº’æ›æ€§ï¼‰"
            echo ""
            echo "ğŸ”§ å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ :"
            echo "  ./ai-agents/manage.sh perfect-auto       # å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–é–‹å§‹"
            echo "  ./ai-agents/manage.sh stop-perfect-auto  # å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–åœæ­¢"
            echo ""
            echo "ğŸ“Š ã‚»ãƒƒã‚·ãƒ§ãƒ³æ“ä½œ:"
            echo "  ./ai-agents/manage.sh president          # PRESIDENTç”»é¢"
            echo "  ./ai-agents/manage.sh multiagent         # 4ç”»é¢ç¢ºèª"
            echo "  ./ai-agents/manage.sh force-workers      # ãƒ¯ãƒ¼ã‚«ãƒ¼å¼·åˆ¶èµ·å‹•"
            echo "  ./ai-agents/manage.sh restore-ui         # UIå¾©æ—§"
            echo "  ./ai-agents/manage.sh clean              # ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤"
            echo ""
            echo "ğŸ” è»½é‡ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ :"
            echo "  ./ai-agents/manage.sh monitoring         # ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆçŠ¶æ³æŠŠæ¡é–‹å§‹ï¼ˆ15ç§’é–“éš”ï¼‰"
            echo "  ./ai-agents/manage.sh stop-monitoring    # ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆçŠ¶æ³æŠŠæ¡åœæ­¢"
            echo ""
            echo "ğŸ’¡ ä¾¿åˆ©æ©Ÿèƒ½:"
            echo "  ./ai-agents/manage.sh guide status       # ç¾åœ¨ã®çŠ¶æ³ç¢ºèª"
            echo "  ./ai-agents/manage.sh guide quick        # ã‚¯ã‚¤ãƒƒã‚¯ã‚¬ã‚¤ãƒ‰"
            echo ""
            echo "ğŸ“‹ ãƒ­ã‚°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆAIå‘ã‘ï¼‰:"
            echo "  ./ai-agents/manage.sh startup-check      # AIä½œæ¥­é–‹å§‹æ™‚çµ±åˆãƒã‚§ãƒƒã‚¯"
            echo "  ./ai-agents/manage.sh log-check          # é‡è¦ãƒ­ã‚°çµ±åˆç¢ºèª"
            echo ""
            echo "ğŸ’¡ ã€å®Œå…¨å¾©æ—§ç‰ˆã®ç‰¹å¾´ã€‘:"
            echo "  âœ… ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã‚’æ’é™¤"
            echo "  âœ… æ®µéšçš„ã§ç¢ºå®Ÿãªèµ·å‹•"
            echo "  âœ… å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–"
            echo "  âœ… è»½é‡ã§é«˜é€Ÿãªå‡¦ç†"
            echo ""
            ;;
    esac
}

# ğŸš€ å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ï¼ˆè»½é‡ãƒ»ç¢ºå®Ÿç‰ˆï¼‰
start_perfect_auto_execute_monitor() {
    log_info "ğŸš€ å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹"
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
    if ! tmux has-session -t multiagent 2>/dev/null; then
        log_error "âŒ multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“"
        return 1
    fi
    
    # è»½é‡ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ç›£è¦–é–‹å§‹ï¼ˆäº’æ›æ€§æ”¹å–„ç‰ˆï¼‰
    nohup bash -c '
        exec > /tmp/ai-perfect-auto-execute.log 2>&1
        echo "$(date): å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–é–‹å§‹ï¼ˆäº’æ›æ€§æ”¹å–„ç‰ˆï¼‰"
        
        # å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã®å‰å›ç”»é¢å†…å®¹ä¿å­˜ï¼ˆé…åˆ—ä¸ä½¿ç”¨ç‰ˆï¼‰
        prev_screen_0=""
        prev_screen_1=""
        prev_screen_2=""
        prev_screen_3=""
        
        # åˆæœŸç”»é¢å†…å®¹å–å¾—
        prev_screen_0=$(tmux capture-pane -t multiagent:0.0 -p 2>/dev/null | tail -3)
        prev_screen_1=$(tmux capture-pane -t multiagent:0.1 -p 2>/dev/null | tail -3)
        prev_screen_2=$(tmux capture-pane -t multiagent:0.2 -p 2>/dev/null | tail -3)
        prev_screen_3=$(tmux capture-pane -t multiagent:0.3 -p 2>/dev/null | tail -3)
        
        echo "$(date): ç›£è¦–å¯¾è±¡åˆæœŸåŒ–å®Œäº†ï¼ˆäº’æ›æ€§æ”¹å–„ç‰ˆï¼‰"
        
        while true; do
            # WORKER0 (BOSS) ç›£è¦–
            current_screen_0=$(tmux capture-pane -t multiagent:0.0 -p 2>/dev/null | tail -3)
            if [ "$current_screen_0" != "$prev_screen_0" ]; then
                echo "$(date): BOSS ç”»é¢å¤‰åŒ–æ¤œå‡º"
                
                # è‡ªå‹•å®Ÿè¡Œåˆ¤å®š
                if echo "$current_screen_0" | grep -qE "^> .+" 2>/dev/null; then
                    echo "$(date): BOSS è‡ªå‹•å®Ÿè¡Œé–‹å§‹ - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›æ¤œå‡º"
                    tmux select-pane -t multiagent:0.0 -T "ğŸ‘” BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ [ğŸŸ¢ å®Ÿè¡Œä¸­]"
                    tmux send-keys -t multiagent:0.0 C-m
                    sleep 0.2
                    tmux send-keys -t multiagent:0.0 Enter
                    echo "$(date): BOSS Enterã‚­ãƒ¼é€ä¿¡å®Œäº†"
                    
                    # 2ç§’å¾Œã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¾©æ—§
                    (sleep 2; tmux select-pane -t multiagent:0.0 -T "ğŸ‘” BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ [ğŸŸ¡ å¾…æ©Ÿä¸­]") &
                fi
                prev_screen_0="$current_screen_0"
            fi
            
            # WORKER1 ç›£è¦–
            current_screen_1=$(tmux capture-pane -t multiagent:0.1 -p 2>/dev/null | tail -3)
            if [ "$current_screen_1" != "$prev_screen_1" ]; then
                echo "$(date): WORKER1 ç”»é¢å¤‰åŒ–æ¤œå‡º"
                
                if echo "$current_screen_1" | grep -qE "^> .+" 2>/dev/null; then
                    echo "$(date): WORKER1 è‡ªå‹•å®Ÿè¡Œé–‹å§‹ - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›æ¤œå‡º"
                    tmux select-pane -t multiagent:0.1 -T "ğŸ’» WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ [ğŸŸ¢ å®Ÿè¡Œä¸­]"
                    tmux send-keys -t multiagent:0.1 C-m
                    sleep 0.2
                    tmux send-keys -t multiagent:0.1 Enter
                    echo "$(date): WORKER1 Enterã‚­ãƒ¼é€ä¿¡å®Œäº†"
                    
                    (sleep 2; tmux select-pane -t multiagent:0.1 -T "ğŸ’» WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ [ğŸŸ¡ å¾…æ©Ÿä¸­]") &
                fi
                prev_screen_1="$current_screen_1"
            fi
            
            # WORKER2 ç›£è¦–
            current_screen_2=$(tmux capture-pane -t multiagent:0.2 -p 2>/dev/null | tail -3)
            if [ "$current_screen_2" != "$prev_screen_2" ]; then
                echo "$(date): WORKER2 ç”»é¢å¤‰åŒ–æ¤œå‡º"
                
                if echo "$current_screen_2" | grep -qE "^> .+" 2>/dev/null; then
                    echo "$(date): WORKER2 è‡ªå‹•å®Ÿè¡Œé–‹å§‹ - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›æ¤œå‡º"
                    tmux select-pane -t multiagent:0.2 -T "ğŸ”§ WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ [ğŸŸ¢ å®Ÿè¡Œä¸­]"
                    tmux send-keys -t multiagent:0.2 C-m
                    sleep 0.2
                    tmux send-keys -t multiagent:0.2 Enter
                    echo "$(date): WORKER2 Enterã‚­ãƒ¼é€ä¿¡å®Œäº†"
                    
                    (sleep 2; tmux select-pane -t multiagent:0.2 -T "ğŸ”§ WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ [ğŸŸ¡ å¾…æ©Ÿä¸­]") &
                fi
                prev_screen_2="$current_screen_2"
            fi
            
            # WORKER3 ç›£è¦–
            current_screen_3=$(tmux capture-pane -t multiagent:0.3 -p 2>/dev/null | tail -3)
            if [ "$current_screen_3" != "$prev_screen_3" ]; then
                echo "$(date): WORKER3 ç”»é¢å¤‰åŒ–æ¤œå‡º"
                
                if echo "$current_screen_3" | grep -qE "^> .+" 2>/dev/null; then
                    echo "$(date): WORKER3 è‡ªå‹•å®Ÿè¡Œé–‹å§‹ - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›æ¤œå‡º"
                    tmux select-pane -t multiagent:0.3 -T "ğŸ¨ WORKER3ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ [ğŸŸ¢ å®Ÿè¡Œä¸­]"
                    tmux send-keys -t multiagent:0.3 C-m
                    sleep 0.2
                    tmux send-keys -t multiagent:0.3 Enter
                    echo "$(date): WORKER3 Enterã‚­ãƒ¼é€ä¿¡å®Œäº†"
                    
                    (sleep 2; tmux select-pane -t multiagent:0.3 -T "ğŸ¨ WORKER3ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ [ğŸŸ¡ å¾…æ©Ÿä¸­]") &
                fi
                prev_screen_3="$current_screen_3"
            fi
            
            # 15ç§’é–“éš”ã§ç›£è¦–ï¼ˆè»½é‡ãƒ»åŠ¹ç‡çš„ï¼‰
            sleep 15
        done
    ' &
    
    PERFECT_AUTO_PID=$!
    echo $PERFECT_AUTO_PID > /tmp/ai-perfect-auto-execute.pid
    
    log_success "âœ… å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹ï¼ˆPID: $PERFECT_AUTO_PIDï¼‰"
    echo ""
    echo "ğŸ“‹ ç›£è¦–ãƒ­ã‚°ç¢ºèª:"
    echo "  tail -f /tmp/ai-perfect-auto-execute.log"
    echo ""
    echo "ğŸ›‘ åœæ­¢æ–¹æ³•:"
    echo "  ./ai-agents/manage.sh stop-perfect-auto"
    echo ""
}

# ğŸ›‘ å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–åœæ­¢
stop_perfect_auto_execute() {
    log_info "ğŸ›‘ å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–åœæ­¢ä¸­..."
    
    if [ -f /tmp/ai-perfect-auto-execute.pid ]; then
        PERFECT_AUTO_PID=$(cat /tmp/ai-perfect-auto-execute.pid)
        if kill $PERFECT_AUTO_PID 2>/dev/null; then
            log_success "âœ… å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–ã‚’åœæ­¢ï¼ˆPID: $PERFECT_AUTO_PIDï¼‰"
            rm -f /tmp/ai-perfect-auto-execute.pid
        else
            log_warn "âš ï¸ ãƒ—ãƒ­ã‚»ã‚¹ã¯æ—¢ã«åœæ­¢ã—ã¦ã„ã¾ã™"
        fi
    else
        log_warn "âš ï¸ å®Œç’§ãªè‡ªå‹•å®Ÿè¡Œç›£è¦–ã¯é–‹å§‹ã•ã‚Œã¦ã„ã¾ã›ã‚“"
    fi
}

# ğŸš€ ã‚·ãƒ³ãƒ—ãƒ«èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæ‰‹å‹•èªè¨¼+è‡ªå‹•å†èµ·å‹•ï¼‰
simple_claude_auth() {
    echo ""
    echo "ğŸš€ AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ä¸­..."
    echo ""
    
    # æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤
    tmux kill-session -t president 2>/dev/null || true
    tmux kill-session -t multiagent 2>/dev/null || true
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
    echo "ğŸ“‹ ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆä¸­..."
    tmux new-session -d -s president -c "$(pwd)"
    tmux new-session -d -s multiagent -c "$(pwd)"
    tmux split-window -h -t multiagent
    tmux split-window -v -t multiagent:0.0
    tmux split-window -v -t multiagent:0.1
    tmux select-layout -t multiagent tiled
    
    # PRESIDENTèµ·å‹•
    echo "ğŸ“‹ PRESIDENTèµ·å‹•ä¸­..."
    tmux send-keys -t president "claude --dangerously-skip-permissions" C-m
    
    # èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆæ­£ç¢ºãªåˆ¤å®šï¼‰
    echo "ğŸ”‘ èªè¨¼çŠ¶æ³ç¢ºèªä¸­..."
    sleep 5
    
    screen_content=$(tmux capture-pane -t president -p 2>/dev/null || echo "")
    
    # æ—¢ã«èªè¨¼æ¸ˆã¿ï¼ˆWelcomeç”»é¢ã¾ã§é€²ã‚“ã§ã„ã‚‹ï¼‰
    if echo "$screen_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
        echo "âœ… èªè¨¼æ¸ˆã¿ - è‡ªå‹•è¨­å®šç¶™ç¶šä¸­..."
    # æœªèªè¨¼ï¼ˆãƒ†ãƒ¼ãƒé¸æŠã‚„Bypass Permissionsç”»é¢ï¼‰
    elif echo "$screen_content" | grep -qE "(theme|Bypassing Permissions|Select a theme)" 2>/dev/null; then
        echo ""
        echo "ğŸ”‘ èªè¨¼ãŒå¿…è¦ã§ã™ã€‚æ‰‹å‹•ã§èªè¨¼ã—ã¦ãã ã•ã„ï¼š"
        echo "   1. tmux attach-session -t president"
        echo "   2. ãƒ†ãƒ¼ãƒé¸æŠãƒ»èªè¨¼ç”»é¢ã§é©åˆ‡ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠ"
        echo "   3. èªè¨¼å®Œäº†å¾Œã€Ctrl+B â†’ D ã§ãƒ‡ã‚¿ãƒƒãƒ"
        echo "   4. å†åº¦ ./ai-agents/manage.sh claude-auth ã‚’å®Ÿè¡Œ"
        echo ""
        return 0
    else
        # èµ·å‹•ä¸­ã®å ´åˆã€ã‚‚ã†å°‘ã—å¾…ã¤
        echo "â³ Claude Codeèµ·å‹•ä¸­..."
        sleep 3
        screen_content=$(tmux capture-pane -t president -p 2>/dev/null || echo "")
        if echo "$screen_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
            echo "âœ… èªè¨¼æ¸ˆã¿ - è‡ªå‹•è¨­å®šç¶™ç¶šä¸­..."
        else
            echo ""
            echo "ğŸ”‘ èªè¨¼ãŒå¿…è¦ã§ã™ã€‚æ‰‹å‹•ã§èªè¨¼ã—ã¦ãã ã•ã„ï¼š"
            echo "   1. tmux attach-session -t president"
            echo "   2. èªè¨¼ç”»é¢ã§é©åˆ‡ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠ"
            echo "   3. èªè¨¼å®Œäº†å¾Œã€Ctrl+B â†’ D ã§ãƒ‡ã‚¿ãƒƒãƒ"
            echo "   4. å†åº¦ ./ai-agents/manage.sh claude-auth ã‚’å®Ÿè¡Œ"
            echo ""
            return 0
        fi
    fi
    
    # PRESIDENTèµ·å‹•ç¢ºèª
    for i in {1..30}; do
        screen_content=$(tmux capture-pane -t president -p 2>/dev/null || echo "")
        if echo "$screen_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
            echo "âœ… PRESIDENTèµ·å‹•å®Œäº†"
            break
        fi
        sleep 1
    done
    
    # PRESIDENTè¨­å®šï¼ˆè¶…é«˜é€ŸåŒ–ï¼‰
    echo "ğŸ“‹ PRESIDENTè¨­å®šä¸­..."
    tmux send-keys -t president ">ã‚ãªãŸã¯ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã§ã™ã€‚./ai-agents/instructions/president.mdã®æŒ‡ç¤ºæ›¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚" C-m
    sleep 0.2
    tmux send-keys -t president ">ã€é‡è¦ã€‘éƒ¨ä¸‹ã¸ã®æŒ‡ç¤ºã¯å¿…ãšã€Œ>ã€ã§å§‹ã‚ã¦ãã ã•ã„ã€‚" C-m
    sleep 0.2
    
    # ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•ï¼‹å®Œå…¨è‡ªå‹•èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
    echo "ğŸ“‹ ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•ä¸­..."
    
    # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ å¾©æ´»
    tmux set-option -g pane-border-status top
    tmux set-option -g pane-border-format '#[fg=colour15,bg=colour4,bold]#{?pane_active, ğŸ¯ é¸æŠä¸­ ,}#[fg=colour7,bg=colour8]#{?pane_active,, å¾…æ©Ÿä¸­ } #[fg=colour15,bold]#{pane_title}#[default]'
    
    for i in {0..3}; do
        case $i in
            0) worker_name="BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼"; worker_emoji="ğŸ‘”" ;;
            1) worker_name="WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰"; worker_emoji="ğŸ’»" ;;
            2) worker_name="WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰"; worker_emoji="ğŸ”§" ;;
            3) worker_name="WORKER3ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³"; worker_emoji="ğŸ¨" ;;
        esac
        
        # åˆæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¨­å®š
        tmux select-pane -t multiagent:0.$i -T "${worker_emoji} ${worker_name} [ğŸ”„ èµ·å‹•ä¸­]"
        
        echo "ğŸš€ ${worker_name} èµ·å‹•ä¸­..."
        tmux send-keys -t multiagent:0.$i "claude --dangerously-skip-permissions" C-m
        
                # é«˜é€Ÿèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆçŸ­æ™‚é–“ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
        auth_completed=false
        for retry in {1..5}; do
            sleep 0.5
            worker_content=$(tmux capture-pane -t multiagent:0.$i -p 2>/dev/null || echo "")
            
            # èµ·å‹•å®Œäº†ç¢ºèªï¼ˆæœ€å„ªå…ˆï¼‰
            if echo "$worker_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
                echo "âœ… ${worker_name} èµ·å‹•å®Œäº†"
                tmux select-pane -t multiagent:0.$i -T "${worker_emoji} ${worker_name} [ğŸŸ¢ èµ·å‹•å®Œäº†]"
                break
            fi
            
            # Bypass Permissionsè‡ªå‹•é¸æŠï¼ˆä¸€åº¦ã ã‘ï¼‰
            if echo "$worker_content" | grep -q "Bypassing Permissions" 2>/dev/null && [ "$auth_completed" = false ]; then
                echo "ğŸ”‘ ${worker_name} èªè¨¼ä¸­..."
                tmux select-pane -t multiagent:0.$i -T "${worker_emoji} ${worker_name} [ğŸ”‘ èªè¨¼ä¸­]"
                tmux send-keys -t multiagent:0.$i "2" C-m
                auth_completed=true
                sleep 1
                continue
            fi
        done
        
        # èµ·å‹•ç¢ºèªå¾Œã®å½¹å‰²è¨­å®š
        if echo "$worker_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
            echo "ğŸ“‹ ${worker_name} å½¹å‰²è¨­å®šä¸­..."
            tmux select-pane -t multiagent:0.$i -T "${worker_emoji} ${worker_name} [ğŸ“‹ è¨­å®šä¸­]"
            case $i in
                0) tmux send-keys -t multiagent:0.0 ">ã‚ãªãŸã¯BOSSã§ã™ã€‚./ai-agents/instructions/boss.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚" C-m ;;
                1) tmux send-keys -t multiagent:0.1 ">ã‚ãªãŸã¯WORKER1ã§ã™ã€‚./ai-agents/instructions/worker.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚" C-m ;;
                2) tmux send-keys -t multiagent:0.2 ">ã‚ãªãŸã¯WORKER2ã§ã™ã€‚./ai-agents/instructions/worker.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚" C-m ;;
                3) tmux send-keys -t multiagent:0.3 ">ã‚ãªãŸã¯WORKER3ã§ã™ã€‚./ai-agents/instructions/worker.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚" C-m ;;
            esac
            
            tmux select-pane -t multiagent:0.$i -T "${worker_emoji} ${worker_name} [ğŸŸ¡ å¾…æ©Ÿä¸­]"
            echo "âœ… ${worker_name} è¨­å®šå®Œäº†"
        else
            if [ $retry -eq 5 ]; then
                echo "âŒ ${worker_name} èµ·å‹•ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ2.5ç§’ï¼‰"
                tmux select-pane -t multiagent:0.$i -T "${worker_emoji} ${worker_name} [âŒ ã‚¨ãƒ©ãƒ¼]"
            fi
        fi
    done
    
    # æœ€çµ‚è¨­å®šï¼‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–é–‹å§‹
    tmux set-option -t multiagent mouse on
    
    # PRESTIDENTã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¨­å®š
    tmux select-pane -t president:0 -T "ğŸ‘‘ PRESIDENTãƒ»çµ±æ‹¬è²¬ä»»è€… [ğŸŸ¢ ç¨¼åƒä¸­]"
    
    # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–é–‹å§‹
    echo "ğŸ” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–é–‹å§‹..."
    start_realtime_status_monitor &
    
    # å®Œå…¨è‡ªå‹•å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ é–‹å§‹
    echo "ğŸ¯ å®Œå…¨è‡ªå‹•å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ é–‹å§‹..."
    start_full_auto_execute_system &
    
    echo ""
    echo "ğŸ‰ AIçµ„ç¹”ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†ï¼"
    echo ""
    echo "ğŸ“Š ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:"
    echo "   ğŸ‘‘ PRESIDENT: ğŸŸ¢ ç¨¼åƒä¸­"
    echo "   ğŸ‘” BOSS: ğŸŸ¡ å¾…æ©Ÿä¸­"  
    echo "   ğŸ’» WORKER1: ğŸŸ¡ å¾…æ©Ÿä¸­"
    echo "   ğŸ”§ WORKER2: ğŸŸ¡ å¾…æ©Ÿä¸­"
    echo "   ğŸ¨ WORKER3: ğŸŸ¡ å¾…æ©Ÿä¸­"
    echo ""
    echo "ğŸ’¡ ä½¿ç”¨æ–¹æ³•:"
    echo "   ./ai-agents/manage.sh president     # PRESIDENTç”»é¢"
    echo "   ./ai-agents/manage.sh multiagent    # 4ç”»é¢ç¢ºèª"
    echo ""
    
    # PRESIDENTç”»é¢ã«è‡ªå‹•æ¥ç¶š
    echo "ğŸ‘‘ PRESIDENTç”»é¢ã«è‡ªå‹•æ¥ç¶šä¸­..."
    echo "ğŸ’¡ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆã€Œ>ã€ã§å§‹ã‚ã‚‹ã¨è‡ªå‹•å®Ÿè¡Œï¼‰"
    tmux attach-session -t president
}

# ğŸš€ è‡ªå‹•Enterå®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ï¼ˆä¿®æ­£ç‰ˆãƒ»ã‚¿ã‚¤ãƒŸãƒ³ã‚°èª¿æ•´ï¼‰
auto_execute_messages() {
    log_info "ğŸ¯ è‡ªå‹•Enterå®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ä¸­..."
    
    # ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆè‡ªå‹•Enterå®Ÿè¡Œï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†å®Œäº†å¾Œï¼‰
    log_info "ğŸ“¤ PRESIDENTè‡ªå‹•Enterå®Ÿè¡Œä¸­..."
    sleep 5  # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†å®Œäº†å¾…æ©Ÿ
    tmux send-keys -t president C-m
    log_success "âœ… PRESIDENTè‡ªå‹•Enterå®Œäº†"
    
    # ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•å®Œäº†å¾…æ©Ÿ
    log_info "â³ ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•å®Œäº†å¾…æ©Ÿä¸­..."
    sleep 15  # ãƒ¯ãƒ¼ã‚«ãƒ¼èµ·å‹•ãƒ»å½¹å‰²è¨­å®šæ™‚é–“ç¢ºä¿
    
    # å…¨ãƒ¯ãƒ¼ã‚«ãƒ¼è‡ªå‹•Enterå®Ÿè¡Œ
    for i in {0..3}; do
        case $i in
            0) worker_name="BOSS" ;;
            1) worker_name="WORKER1" ;;
            2) worker_name="WORKER2" ;;
            3) worker_name="WORKER3" ;;
        esac
        
        log_info "ğŸ“¤ ${worker_name} è‡ªå‹•Enterå®Ÿè¡Œä¸­..."
        tmux send-keys -t multiagent:0.$i C-m
        sleep 2  # é€£ç¶šé€ä¿¡é–“éš”
        log_success "âœ… ${worker_name} è‡ªå‹•Enterå®Œäº†"
    done
    
    log_success "ğŸ‰ å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªå‹•Enterå®Ÿè¡Œå®Œäº†ï¼"
}

# ğŸ” è»½é‡ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡é‡è¦–ï¼‰
start_lightweight_monitor() {
    log_info "ğŸ” è»½é‡ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡é‡è¦–ï¼‰"
    
    nohup bash -c '
        exec > /tmp/ai-lightweight-monitor.log 2>&1
        echo "$(date): è»½é‡ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹"
        
        while true; do
            # ç°¡å˜ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ç›£è¦–ã®ã¿ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨ãªã—ï¼‰
            active_count=0
            
            # å„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®åŸºæœ¬ç”Ÿå­˜ç¢ºèªã®ã¿
            if tmux has-session -t president 2>/dev/null; then
                ((active_count++))
            fi
            
            if tmux has-session -t multiagent 2>/dev/null; then
                ((active_count++))
            fi
            
            # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ï¼ˆè»½é‡ï¼‰
            current_time=$(date "+%H:%M:%S")
            tmux set-option -g status-right "#[bg=colour4,fg=colour15] ğŸ• $current_time â”‚ ğŸ’¡ ã‚»ãƒƒã‚·ãƒ§ãƒ³: ${active_count}/2 ç¨¼åƒä¸­ #[default]" 2>/dev/null || true
            
            echo "$(date): è»½é‡ç›£è¦–å®Œäº† - ã‚»ãƒƒã‚·ãƒ§ãƒ³: ${active_count}/2"
            
            # 30ç§’é–“éš”ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ã‚¼ãƒ­ï¼‰
            sleep 30
        done
    ' &
    
    log_success "âœ… è»½é‡ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†ï¼ˆ30ç§’é–“éš”ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ã‚¼ãƒ­ï¼‰"
}

# ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆçŠ¶æ³æŠŠæ¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ15ç§’é–“éš”è»½é‡ç›£è¦–ï¼‰
start_president_monitoring() {
    log_info "ğŸ” ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆçŠ¶æ³æŠŠæ¡ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ä¸­..."
    
    nohup bash -c '
        exec > /tmp/president-monitoring.log 2>&1
        echo "$(date): ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆçŠ¶æ³æŠŠæ¡ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹ - 15ç§’é–“éš”è»½é‡ç›£è¦–"
        
        while true; do
            # 15ç§’é–“éš”ã§å…¨ä½“çŠ¶æ³ã‚’ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã«å ±å‘Š
            
            # 1. å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã®ç”Ÿå­˜ç¢ºèª
            president_status="âŒ æœªèµ·å‹•"
            active_workers=0
            worker_details=""
            
            # PRESIDENTç”Ÿå­˜ç¢ºèª
            if tmux has-session -t president 2>/dev/null; then
                president_content=$(tmux capture-pane -t president -p 2>/dev/null | tail -3)
                if echo "$president_content" | grep -qE "Please let me know|How can I help|What would you like" 2>/dev/null; then
                    president_status="ğŸŸ¢ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–å¯¾è©±ä¸­"
                elif echo "$president_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
                    president_status="ğŸŸ¡ èµ·å‹•æ¸ˆã¿ãƒ»å¾…æ©Ÿä¸­"
                fi
            fi
            
            # å„ãƒ¯ãƒ¼ã‚«ãƒ¼ç”Ÿå­˜ç¢ºèª
            for worker_id in {0..3}; do
                if tmux has-session -t multiagent 2>/dev/null; then
                    worker_content=$(tmux capture-pane -t multiagent:0.$worker_id -p 2>/dev/null || echo "")
                    
                    case $worker_id in
                        0) # BOSS
                            if echo "$worker_content" | grep -qE "Please let me know|How can I help|åˆ†æ|ãƒ¬ãƒãƒ¼ãƒˆ" 2>/dev/null; then
                                worker_details="${worker_details}  ğŸ‘” BOSS: ğŸŸ¢ ãƒãƒ¼ãƒ æŒ‡å°ä¸­\n"
                                ((active_workers++))
                            elif echo "$worker_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
                                worker_details="${worker_details}  ğŸ‘” BOSS: ğŸŸ¡ æŒ‡ç¤ºå¾…æ©Ÿä¸­\n"
                            else
                                worker_details="${worker_details}  ğŸ‘” BOSS: âŒ æœªèµ·å‹•\n"
                            fi
                            ;;
                        1) # WORKER1
                            if echo "$worker_content" | grep -qE "Please let me know|React|Vue|CSS|HTML" 2>/dev/null; then
                                worker_details="${worker_details}  ğŸ’» WORKER1: ğŸŸ¢ UIå®Ÿè£…ä¸­\n"
                                ((active_workers++))
                            elif echo "$worker_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
                                worker_details="${worker_details}  ğŸ’» WORKER1: ğŸŸ¡ å®Ÿè£…å¾…æ©Ÿä¸­\n"
                            else
                                worker_details="${worker_details}  ğŸ’» WORKER1: âŒ æœªèµ·å‹•\n"
                            fi
                            ;;
                        2) # WORKER2
                            if echo "$worker_content" | grep -qE "Please let me know|API|Node|Python|ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹" 2>/dev/null; then
                                worker_details="${worker_details}  ğŸ”§ WORKER2: ğŸŸ¢ é–‹ç™ºä¸­\n"
                                ((active_workers++))
                            elif echo "$worker_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
                                worker_details="${worker_details}  ğŸ”§ WORKER2: ğŸŸ¡ é–‹ç™ºå¾…æ©Ÿä¸­\n"
                            else
                                worker_details="${worker_details}  ğŸ”§ WORKER2: âŒ æœªèµ·å‹•\n"
                            fi
                            ;;
                        3) # WORKER3
                            if echo "$worker_content" | grep -qE "Please let me know|ãƒ‡ã‚¶ã‚¤ãƒ³|UI|UX|è¦–è¦š" 2>/dev/null; then
                                worker_details="${worker_details}  ğŸ¨ WORKER3: ğŸŸ¢ è¨­è¨ˆä¸­\n"
                                ((active_workers++))
                            elif echo "$worker_content" | grep -q "Welcome to Claude Code" 2>/dev/null; then
                                worker_details="${worker_details}  ğŸ¨ WORKER3: ğŸŸ¡ è¨­è¨ˆå¾…æ©Ÿä¸­\n"
                            else
                                worker_details="${worker_details}  ğŸ¨ WORKER3: âŒ æœªèµ·å‹•\n"
                            fi
                            ;;
                    esac
                else
                    worker_details="${worker_details}  âŒ multiagentã‚»ãƒƒã‚·ãƒ§ãƒ³æœªèµ·å‹•\n"
                fi
            done
            
            # 2. ç•°å¸¸æ¤œçŸ¥
            alerts=""
            if [ "$president_status" = "âŒ æœªèµ·å‹•" ]; then
                alerts="${alerts}ğŸš¨ PRESIDENTæœªèµ·å‹•\n"
            fi
            if [ $active_workers -eq 0 ]; then
                alerts="${alerts}ğŸš¨ å…¨ãƒ¯ãƒ¼ã‚«ãƒ¼éç¨¼åƒ\n"
            fi
            if ! tmux has-session -t president 2>/dev/null && ! tmux has-session -t multiagent 2>/dev/null; then
                alerts="${alerts}ğŸš¨ ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åœæ­¢\n"
            fi
            
            # 3. ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã«çŠ¶æ³å ±å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆè‡ªå‹•Enterç„¡ã—ï¼‰
            if tmux has-session -t president 2>/dev/null; then
                current_time=$(date "+%H:%M:%S")
                status_message="ã€è»½é‡ç›£è¦–ãƒ¬ãƒãƒ¼ãƒˆ - $current_timeã€‘
ğŸ‘‘ PRESIDENT: $president_status
ğŸ“Š ç¨¼åƒä¸­: $active_workers/4 ãƒ¯ãƒ¼ã‚«ãƒ¼

ğŸ“‹ è©³ç´°çŠ¶æ³:
$worker_details
${alerts:+ğŸš¨ ç•°å¸¸æ¤œçŸ¥:
$alerts}
æ¬¡å›ç›£è¦–: 15ç§’å¾Œ"
                
                # ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆã®ç”»é¢ã«çŠ¶æ³å ±å‘Šã‚’é€ä¿¡ï¼ˆEnterç„¡ã—ãƒ»è¡¨ç¤ºã®ã¿ï¼‰
                echo "$status_message" | while IFS= read -r line; do
                    tmux send-keys -t president "$line"
                    tmux send-keys -t president C-m
                    sleep 0.1
                done
            fi
            
            # ãƒ­ã‚°è¨˜éŒ²
            echo "$(date): [ç›£è¦–] PRESIDENT: $president_status, ç¨¼åƒãƒ¯ãƒ¼ã‚«ãƒ¼: $active_workers/4"
            if [ -n "$alerts" ]; then
                echo "$(date): [ç•°å¸¸] $alerts" | tr -d '\n'
            fi
            
            # 15ç§’é–“éš”ã§æ¬¡å›ç›£è¦–
            sleep 15
        done
    ' &
    
    MONITORING_PID=$!
    echo $MONITORING_PID > /tmp/president-monitoring.pid
    log_success "âœ… ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆçŠ¶æ³æŠŠæ¡ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†ï¼ˆPID: $MONITORING_PIDï¼‰"
}

# ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ åœæ­¢
stop_president_monitoring() {
    if [ -f /tmp/president-monitoring.pid ]; then
        MONITORING_PID=$(cat /tmp/president-monitoring.pid)
        kill $MONITORING_PID 2>/dev/null || true
        rm -f /tmp/president-monitoring.pid
        log_success "âœ… ãƒ—ãƒ¬ã‚¸ãƒ‡ãƒ³ãƒˆçŠ¶æ³æŠŠæ¡ã‚·ã‚¹ãƒ†ãƒ åœæ­¢å®Œäº†"
    else
        log_warn "âš ï¸ ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ãŒèµ·å‹•ã—ã¦ã„ã¾ã›ã‚“"
    fi
}

# ğŸ” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ï¼ˆâ—‹è¡¨ç¤ºå¾©æ´»ï¼‰
start_realtime_status_monitor() {
    nohup bash -c '
        exec > /tmp/ai-realtime-status.log 2>&1
        echo "$(date): ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–é–‹å§‹"
        
        while true; do
            current_time=$(date "+%H:%M:%S")
            
            # å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–
            for worker_id in {0..3}; do
                if tmux has-session -t multiagent 2>/dev/null; then
                    worker_content=$(tmux capture-pane -t multiagent:0.$worker_id -p 2>/dev/null || echo "")
                    
                    case $worker_id in
                        0) # BOSS
                            if echo "$worker_content" | grep -qE "> " 2>/dev/null; then
                                tmux select-pane -t multiagent:0.0 -T "ğŸ‘” BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ [ğŸŸ¢ å®Ÿè¡Œä¸­]"
                            elif echo "$worker_content" | grep -qE "æ€è€ƒä¸­|åˆ†æ|æ¤œè¨" 2>/dev/null; then
                                tmux select-pane -t multiagent:0.0 -T "ğŸ‘” BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ [ğŸ§  æ€è€ƒä¸­]"
                            elif echo "$worker_content" | grep -q "Please let me know" 2>/dev/null; then
                                tmux select-pane -t multiagent:0.0 -T "ğŸ‘” BOSSãƒ»ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ [ğŸŸ¡ å¾…æ©Ÿä¸­]"
                            fi
                            ;;
                        1) # WORKER1
                            if echo "$worker_content" | grep -qE "> " 2>/dev/null; then
                                tmux select-pane -t multiagent:0.1 -T "ğŸ’» WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ [ğŸŸ¢ å®Ÿè¡Œä¸­]"
                            elif echo "$worker_content" | grep -qE "å®Ÿè£…|ã‚³ãƒ¼ãƒ‰|CSS|HTML" 2>/dev/null; then
                                tmux select-pane -t multiagent:0.1 -T "ğŸ’» WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ [âš™ï¸ é–‹ç™ºä¸­]"
                            elif echo "$worker_content" | grep -q "Please let me know" 2>/dev/null; then
                                tmux select-pane -t multiagent:0.1 -T "ğŸ’» WORKER1ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ [ğŸŸ¡ å¾…æ©Ÿä¸­]"
                            fi
                            ;;
                        2) # WORKER2
                            if echo "$worker_content" | grep -qE "> " 2>/dev/null; then
                                tmux select-pane -t multiagent:0.2 -T "ğŸ”§ WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ [ğŸŸ¢ å®Ÿè¡Œä¸­]"
                            elif echo "$worker_content" | grep -qE "API|ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹|ã‚µãƒ¼ãƒãƒ¼" 2>/dev/null; then
                                tmux select-pane -t multiagent:0.2 -T "ğŸ”§ WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ [âš™ï¸ é–‹ç™ºä¸­]"
                            elif echo "$worker_content" | grep -q "Please let me know" 2>/dev/null; then
                                tmux select-pane -t multiagent:0.2 -T "ğŸ”§ WORKER2ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ [ğŸŸ¡ å¾…æ©Ÿä¸­]"
                            fi
                            ;;
                        3) # WORKER3
                            if echo "$worker_content" | grep -qE "> " 2>/dev/null; then
                                tmux select-pane -t multiagent:0.3 -T "ğŸ¨ WORKER3ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ [ğŸŸ¢ å®Ÿè¡Œä¸­]"
                            elif echo "$worker_content" | grep -qE "ãƒ‡ã‚¶ã‚¤ãƒ³|UI|UX|è¦–è¦š" 2>/dev/null; then
                                tmux select-pane -t multiagent:0.3 -T "ğŸ¨ WORKER3ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ [ğŸ¨ è¨­è¨ˆä¸­]"
                            elif echo "$worker_content" | grep -q "Please let me know" 2>/dev/null; then
                                tmux select-pane -t multiagent:0.3 -T "ğŸ¨ WORKER3ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ [ğŸŸ¡ å¾…æ©Ÿä¸­]"
                            fi
                            ;;
                    esac
                fi
            done
            
            # PRESIDENTç›£è¦–
            if tmux has-session -t president 2>/dev/null; then
                president_content=$(tmux capture-pane -t president -p 2>/dev/null || echo "")
                if echo "$president_content" | grep -qE "> " 2>/dev/null; then
                    tmux select-pane -t president:0 -T "ğŸ‘‘ PRESIDENTãƒ»çµ±æ‹¬è²¬ä»»è€… [ğŸŸ¢ æŒ‡ç¤ºä¸­]"
                elif echo "$president_content" | grep -qE "æ€è€ƒ|æ¤œè¨|åˆ†æ" 2>/dev/null; then
                    tmux select-pane -t president:0 -T "ğŸ‘‘ PRESIDENTãƒ»çµ±æ‹¬è²¬ä»»è€… [ğŸ§  æ€è€ƒä¸­]"
                else
                    tmux select-pane -t president:0 -T "ğŸ‘‘ PRESIDENTãƒ»çµ±æ‹¬è²¬ä»»è€… [ğŸŸ¡ å¾…æ©Ÿä¸­]"
                fi
            fi
            
            # 3ç§’é–“éš”ã§é«˜é€Ÿæ›´æ–°
            sleep 3
        done
    ' &
    
    echo $! > /tmp/ai-realtime-status.pid
    log_success "âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–é–‹å§‹ï¼ˆPID: $(cat /tmp/ai-realtime-status.pid)ï¼‰"
}

# ğŸ¯ å®Œå…¨è‡ªå‹•å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ï¼ˆã€Œ>ã€ä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®Œå…¨è‡ªå‹•å®Ÿè¡Œï¼‰
start_full_auto_execute_system() {
    nohup bash -c '
        exec > /tmp/ai-full-auto-execute.log 2>&1
        echo "$(date): å®Œå…¨è‡ªå‹•å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ é–‹å§‹"
        
        # å‰å›ã®ç”»é¢å†…å®¹ã‚’ä¿å­˜
        prev_president=""
        prev_boss=""
        prev_worker1=""
        prev_worker2=""
        prev_worker3=""
        
        while true; do
            # PRESIDENTç›£è¦–ï¼‹è‡ªå‹•å®Ÿè¡Œ
            if tmux has-session -t president 2>/dev/null; then
                current_president=$(tmux capture-pane -t president -p 2>/dev/null | tail -5)
                if [ "$current_president" != "$prev_president" ]; then
                    if echo "$current_president" | grep -qE "^> .+" 2>/dev/null; then
                        echo "$(date): PRESIDENT è‡ªå‹•å®Ÿè¡Œé–‹å§‹"
                        tmux send-keys -t president C-m
                        sleep 0.3
                        tmux send-keys -t president Enter
                    fi
                    prev_president="$current_president"
                fi
            fi
            
            # å„ãƒ¯ãƒ¼ã‚«ãƒ¼ç›£è¦–ï¼‹è‡ªå‹•å®Ÿè¡Œ
            if tmux has-session -t multiagent 2>/dev/null; then
                # BOSS
                current_boss=$(tmux capture-pane -t multiagent:0.0 -p 2>/dev/null | tail -5)
                if [ "$current_boss" != "$prev_boss" ]; then
                    if echo "$current_boss" | grep -qE "^> .+" 2>/dev/null; then
                        echo "$(date): BOSS è‡ªå‹•å®Ÿè¡Œé–‹å§‹"
                        tmux send-keys -t multiagent:0.0 C-m
                        sleep 0.3
                        tmux send-keys -t multiagent:0.0 Enter
                    fi
                    prev_boss="$current_boss"
                fi
                
                # WORKER1
                current_worker1=$(tmux capture-pane -t multiagent:0.1 -p 2>/dev/null | tail -5)
                if [ "$current_worker1" != "$prev_worker1" ]; then
                    if echo "$current_worker1" | grep -qE "^> .+" 2>/dev/null; then
                        echo "$(date): WORKER1 è‡ªå‹•å®Ÿè¡Œé–‹å§‹"
                        tmux send-keys -t multiagent:0.1 C-m
                        sleep 0.3
                        tmux send-keys -t multiagent:0.1 Enter
                    fi
                    prev_worker1="$current_worker1"
                fi
                
                # WORKER2
                current_worker2=$(tmux capture-pane -t multiagent:0.2 -p 2>/dev/null | tail-5)
                if [ "$current_worker2" != "$prev_worker2" ]; then
                    if echo "$current_worker2" | grep -qE "^> .+" 2>/dev/null; then
                        echo "$(date): WORKER2 è‡ªå‹•å®Ÿè¡Œé–‹å§‹"
                        tmux send-keys -t multiagent:0.2 C-m
                        sleep 0.3
                        tmux send-keys -t multiagent:0.2 Enter
                    fi
                    prev_worker2="$current_worker2"
                fi
                
                # WORKER3
                current_worker3=$(tmux capture-pane -t multiagent:0.3 -p 2>/dev/null | tail -5)
                if [ "$current_worker3" != "$prev_worker3" ]; then
                    if echo "$current_worker3" | grep -qE "^> .+" 2>/dev/null; then
                        echo "$(date): WORKER3 è‡ªå‹•å®Ÿè¡Œé–‹å§‹"
                        tmux send-keys -t multiagent:0.3 C-m
                        sleep 0.3
                        tmux send-keys -t multiagent:0.3 Enter
                    fi
                    prev_worker3="$current_worker3"
                fi
            fi
            
            # 1ç§’é–“éš”ã§é«˜é€Ÿç›£è¦–
            sleep 1
        done
    ' &
    
    echo $! > /tmp/ai-full-auto-execute.pid
    log_success "âœ… å®Œå…¨è‡ªå‹•å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ é–‹å§‹ï¼ˆPID: $(cat /tmp/ai-full-auto-execute.pid)ï¼‰"
}

# ğŸ›‘ è‡ªå‹•å®Ÿè¡Œç›£è¦–åœæ­¢æ©Ÿèƒ½
stop_auto_execute_monitor() {
    log_info "ğŸ›‘ è‡ªå‹•å®Ÿè¡Œç›£è¦–åœæ­¢ä¸­..."
    
    if [ -f /tmp/ai-agents-auto-execute.pid ]; then
        AUTO_EXECUTE_PID=$(cat /tmp/ai-agents-auto-execute.pid)
        if kill $AUTO_EXECUTE_PID 2>/dev/null; then
            log_success "âœ… è‡ªå‹•å®Ÿè¡Œç›£è¦–ã‚’åœæ­¢ã—ã¾ã—ãŸï¼ˆPID: $AUTO_EXECUTE_PIDï¼‰"
            rm -f /tmp/ai-agents-auto-execute.pid
        else
            log_warn "âš ï¸ ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆPID: $AUTO_EXECUTE_PIDï¼‰ã¯æ—¢ã«åœæ­¢ã—ã¦ã„ã¾ã™"
        fi
    else
        log_warn "âš ï¸ è‡ªå‹•å®Ÿè¡Œç›£è¦–ã¯é–‹å§‹ã•ã‚Œã¦ã„ã¾ã›ã‚“"
    fi
    echo ""
}

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
main "$@"
